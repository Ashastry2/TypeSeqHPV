{
  "sbg:id": "dave/cgr-apps/ion-hpv-typeseqer/60",
  "sbg:revisionsInfo": [
    {
      "sbg:modifiedOn": 1526931208,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "Copy of dave/rd111-typing-v2/ion-hpv-typeseqer/8",
      "sbg:revision": 0
    },
    {
      "sbg:modifiedOn": 1526931776,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "moving to cgr apps folder",
      "sbg:revision": 1
    },
    {
      "sbg:modifiedOn": 1526932910,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "exposed minimum lineage read count",
      "sbg:revision": 2
    },
    {
      "sbg:modifiedOn": 1526933968,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 3
    },
    {
      "sbg:modifiedOn": 1527090949,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "hpv_typing_report (Revision 1)  \"added conditional display\"",
      "sbg:revision": 4
    },
    {
      "sbg:modifiedOn": 1527091933,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "added temporarily bam json output for testing",
      "sbg:revision": 5
    },
    {
      "sbg:modifiedOn": 1527192246,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "hpv_typing_report \"fixing num types pos for grouped output\"",
      "sbg:revision": 6
    },
    {
      "sbg:modifiedOn": 1527192677,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 7
    },
    {
      "sbg:modifiedOn": 1527620139,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "added lineage code back in",
      "sbg:revision": 8
    },
    {
      "sbg:modifiedOn": 1527621216,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "added scatter to bam_json",
      "sbg:revision": 9
    },
    {
      "sbg:modifiedOn": 1527625427,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "read processor \"corrected lineage path args.R\"",
      "sbg:revision": 10
    },
    {
      "sbg:modifiedOn": 1527693072,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "processor - \"removed and args.R typo\"",
      "sbg:revision": 11
    },
    {
      "sbg:modifiedOn": 1527694469,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "added json splitter",
      "sbg:revision": 12
    },
    {
      "sbg:modifiedOn": 1527696804,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "removed json splitter",
      "sbg:revision": 13
    },
    {
      "sbg:modifiedOn": 1527697105,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "processor - \"correteing args.R issue\"",
      "sbg:revision": 14
    },
    {
      "sbg:modifiedOn": 1527870673,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "added lineage table output",
      "sbg:revision": 15
    },
    {
      "sbg:modifiedOn": 1527871225,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "report app - \"added lineage refernce table input\"",
      "sbg:revision": 16
    },
    {
      "sbg:modifiedOn": 1527873571,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 17
    },
    {
      "sbg:modifiedOn": 1527875212,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "fixing dag",
      "sbg:revision": 18
    },
    {
      "sbg:modifiedOn": 1527875232,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 19
    },
    {
      "sbg:modifiedOn": 1527875261,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 20
    },
    {
      "sbg:modifiedOn": 1527875271,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 21
    },
    {
      "sbg:modifiedOn": 1527876630,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "exposed pass through",
      "sbg:revision": 22
    },
    {
      "sbg:modifiedOn": 1527876947,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "",
      "sbg:revision": 23
    },
    {
      "sbg:modifiedOn": 1527877327,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 24
    },
    {
      "sbg:modifiedOn": 1527877694,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "exposed params",
      "sbg:revision": 25
    },
    {
      "sbg:modifiedOn": 1527877735,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 26
    },
    {
      "sbg:modifiedOn": 1528136626,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "\"added safe lineage plot funciton\"",
      "sbg:revision": 27
    },
    {
      "sbg:modifiedOn": 1528136847,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 28
    },
    {
      "sbg:modifiedOn": 1528139561,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "\"removed last line of rscript syntax error\"",
      "sbg:revision": 29
    },
    {
      "sbg:modifiedOn": 1528139626,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "cgc fix",
      "sbg:revision": 30
    },
    {
      "sbg:modifiedOn": 1528142036,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "exposed is_torrent_server",
      "sbg:revision": 31
    },
    {
      "sbg:modifiedOn": 1528142443,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "exposed is_torrent_server",
      "sbg:revision": 32
    },
    {
      "sbg:modifiedOn": 1528168503,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "\"added is_tn\"",
      "sbg:revision": 33
    },
    {
      "sbg:modifiedOn": 1528168600,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 34
    },
    {
      "sbg:modifiedOn": 1528301212,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "dag stuff",
      "sbg:revision": 35
    },
    {
      "sbg:modifiedOn": 1528914156,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "docs",
      "sbg:revision": 36
    },
    {
      "sbg:modifiedOn": 1528914196,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 37
    },
    {
      "sbg:modifiedOn": 1529007013,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "fixed get args in report",
      "sbg:revision": 38
    },
    {
      "sbg:modifiedOn": 1529007096,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "fixed get args",
      "sbg:revision": 39
    },
    {
      "sbg:modifiedOn": 1529009499,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "corrected args.R",
      "sbg:revision": 40
    },
    {
      "sbg:modifiedOn": 1529009758,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 41
    },
    {
      "sbg:modifiedOn": 1529010040,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 42
    },
    {
      "sbg:modifiedOn": 1529264599,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "\"better lineage matrix and plots\"",
      "sbg:revision": 43
    },
    {
      "sbg:modifiedOn": 1529264691,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 44
    },
    {
      "sbg:modifiedOn": 1530021378,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "\"switched to TypeSeqer package\"",
      "sbg:revision": 45
    },
    {
      "sbg:modifiedOn": 1530021871,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 46
    },
    {
      "sbg:modifiedOn": 1530026561,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "corrected final_pn_matrix cp cmd",
      "sbg:revision": 47
    },
    {
      "sbg:modifiedOn": 1530026618,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 48
    },
    {
      "sbg:modifiedOn": 1530037446,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "put cp back in for ts",
      "sbg:revision": 49
    },
    {
      "sbg:modifiedOn": 1530037482,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 50
    },
    {
      "sbg:modifiedOn": 1530046778,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "removed links from tn html block",
      "sbg:revision": 51
    },
    {
      "sbg:modifiedOn": 1530046927,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 52
    },
    {
      "sbg:modifiedOn": 1530099923,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "corrected html page for thumbnail",
      "sbg:revision": 53
    },
    {
      "sbg:modifiedOn": 1530101389,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 54
    },
    {
      "sbg:modifiedOn": 1531490670,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "hpv_typing_report (Revision 19)  \"updated R package name\"",
      "sbg:revision": 55
    },
    {
      "sbg:modifiedOn": 1531490811,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 56
    },
    {
      "sbg:modifiedOn": 1531494365,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "fixing TypeSeqHPV R package name",
      "sbg:revision": 57
    },
    {
      "sbg:modifiedOn": 1531494417,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 58
    },
    {
      "sbg:modifiedOn": 1531515803,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": "final_2018071301",
      "sbg:revision": 59
    },
    {
      "sbg:modifiedOn": 1531515884,
      "sbg:modifiedBy": "dave",
      "sbg:revisionNotes": null,
      "sbg:revision": 60
    }
  ],
  "sbg:projectName": "CGR_Apps",
  "sbg:contributors": [
    "dave"
  ],
  "sbg:appVersion": [
    "sbg:draft-2"
  ],
  "sbg:publisher": "sbg",
  "inputs": [
    {
      "type": [
        "null",
        "File"
      ],
      "label": "parameter_file",
      "sbg:x": 154.1618194580078,
      "sbg:y": 851.0724487304688,
      "id": "#parameter_file"
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "lineage_reference_table",
      "sbg:x": 53.055274963378906,
      "sbg:y": 982.7135620117188,
      "id": "#lineage_reference_table"
    },
    {
      "type": [
        {
          "type": "array",
          "items": "File"
        }
      ],
      "label": "bam",
      "sbg:x": 63.477474212646484,
      "sbg:y": -22.762008666992188,
      "sbg:fileTypes": "BAM, SAM",
      "id": "#input",
      "sbg:includeInPorts": true,
      "secondaryFiles": [
        ".bai"
      ]
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "run_manifest",
      "sbg:x": -38.45930480957031,
      "sbg:y": 174.097900390625,
      "id": "#run_manifest"
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "barcode_list",
      "sbg:x": 232.76622009277344,
      "sbg:y": 1024.540283203125,
      "id": "#barcode_list"
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "control_definitions",
      "sbg:x": -81.65652465820312,
      "sbg:y": 303.99859619140625,
      "id": "#control_definitions",
      "sbg:includeInPorts": true
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "report_grouping",
      "sbg:x": -26.0455265045166,
      "sbg:y": 63.10072326660156,
      "id": "#report_grouping",
      "sbg:includeInPorts": true
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#scaling_table",
      "sbg:x": 367.56280517578125,
      "sbg:y": 1086.0753173828125,
      "sbg:fileTypes": "CSV",
      "id": "#scaling_table",
      "sbg:includeInPorts": true
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#pos_neg_filtering_criteria_path",
      "sbg:x": 10.055275917053223,
      "sbg:y": 751.422119140625,
      "id": "#pos_neg_filtering_criteria_path",
      "sbg:includeInPorts": true
    },
    {
      "type": [
        "null",
        "boolean"
      ],
      "id": "#manifest_json_parse_passthrough"
    },
    {
      "type": [
        "null",
        "boolean"
      ],
      "id": "#control_def_json_parse_passthrough"
    },
    {
      "type": [
        "null",
        "boolean"
      ],
      "id": "#report_grouping_json_parse_passthrough"
    },
    {
      "type": [
        "null",
        "int"
      ],
      "label": "Memory in MB",
      "sbg:toolDefaultValue": "1024",
      "sbg:stageInput": null,
      "description": "Memory in MB.",
      "id": "#mem_mb",
      "sbg:category": "Execution",
      "sbg:suggestedValue": 8000
    },
    {
      "type": [
        "null",
        "boolean"
      ],
      "id": "#is_torrent_server"
    }
  ],
  "$namespaces": {
    "sbg": "https://sevenbridges.com"
  },
  "sbg:revision": 60,
  "sbg:image_url": "https://cgc.sbgenomics.com/ns/brood/images/dave/cgr-apps/ion-hpv-typeseqer/60.png",
  "sbg:modifiedBy": "dave",
  "sbg:toolAuthor": "cgrlab",
  "id": "https://cgc-api.sbgenomics.com/v2/apps/dave/cgr-apps/ion-hpv-typeseqer/60/raw/",
  "sbg:latestRevision": 60,
  "sbg:sbgMaintained": false,
  "outputs": [
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#read_metrics_csv",
      "sbg:x": 2000.58447265625,
      "sbg:y": 654.3377075195312,
      "source": [
        "#ion_typeseqer_report.read_metrics_csv"
      ],
      "id": "#read_metrics_csv",
      "required": false
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#hpv_read_counts_matrix",
      "sbg:x": 2031.8892831868293,
      "sbg:y": 1003.5979641319502,
      "source": [
        "#ion_typeseqer_report.hpv_read_counts_matrix"
      ],
      "id": "#hpv_read_counts_matrix",
      "required": false
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#pos_neg_matrix",
      "sbg:x": 2072.39208984375,
      "sbg:y": 776.9196166992188,
      "source": [
        "#ion_typeseqer_report.pos_neg_matrix"
      ],
      "id": "#pos_neg_matrix",
      "required": false
    },
    {
      "type": [
        "null",
        {
          "type": "array",
          "items": "File"
        }
      ],
      "label": "#pdf_report",
      "sbg:x": 2117.765380859375,
      "sbg:y": 249.97389221191406,
      "source": [
        "#ion_typeseqer_report.pdf_report"
      ],
      "id": "#pdf_report",
      "required": false
    },
    {
      "type": [
        "null",
        {
          "type": "array",
          "items": "File"
        }
      ],
      "label": "#samples_only_matrix",
      "sbg:x": 1896.36181640625,
      "sbg:y": 21.809043884277344,
      "source": [
        "#ion_typeseqer_report.samples_only_matrix"
      ],
      "id": "#samples_only_matrix",
      "required": false
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#failed_samples_matrix",
      "sbg:x": 2016.3116455078125,
      "sbg:y": 330.0703125,
      "source": [
        "#ion_typeseqer_report.failed_samples_matrix"
      ],
      "id": "#failed_samples_matrix",
      "required": false
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#control_matrix",
      "sbg:x": 1887.3902587890625,
      "sbg:y": 409.1229553222656,
      "source": [
        "#ion_typeseqer_report.control_matrix"
      ],
      "id": "#control_matrix",
      "required": false
    },
    {
      "type": [
        "null",
        {
          "type": "array",
          "items": "File"
        }
      ],
      "label": "#plot_data",
      "sbg:x": 2094.200927734375,
      "sbg:y": 878.2462158203125,
      "source": [
        "#ion_typeseqer_report.plot_data"
      ],
      "id": "#plot_data",
      "sbg:includeInPorts": true,
      "required": false
    },
    {
      "type": [
        "null",
        "File"
      ],
      "label": "#lineage_table",
      "sbg:x": 2022.542724609375,
      "sbg:y": 51.64321517944336,
      "source": [
        "#ion_typeseqer_report.lineage_table"
      ],
      "id": "#lineage_table",
      "required": false
    }
  ],
  "sbg:createdOn": 1526931208,
  "sbg:canvas_y": 83,
  "class": "Workflow",
  "hints": [
    {
      "class": "sbg:AWSInstanceType",
      "value": "c4.8xlarge;ebs-gp2;700"
    },
    {
      "class": "sbg:maxNumberOfParallelInstances",
      "value": "12"
    }
  ],
  "requirements": [
    {
      "class": "sbg:Metadata"
    }
  ],
  "steps": [
    {
      "sbg:x": 532.7239379882812,
      "sbg:y": 20.915002822875977,
      "id": "#select_first_file_in_array",
      "inputs": [
        {
          "id": "#select_first_file_in_array.files",
          "source": [
            "#input"
          ]
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/select-first-file-in-array/2",
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1492711798,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of dave/cgrhpv/cat-json/4",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1492712033,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1492712213,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "renamed output",
            "sbg:revision": 2
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1492711798,
        "sbg:job": {
          "inputs": {
            "files": [
              {
                "class": "File",
                "size": 0,
                "path": "path/to/IonXpress_075.bam",
                "secondaryFiles": []
              },
              {
                "class": "File",
                "size": 0,
                "path": "path/to/IonXpress_076.split.bam",
                "secondaryFiles": []
              }
            ]
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "inputs": [
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "id": "#files",
            "sbg:stageInput": "link",
            "required": false
          }
        ],
        "sbg:cmdPreview": "ls -lhrt",
        "sbg:revision": 2,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/select-first-file-in-array/2",
        "baseCommand": [
          "ls",
          "-lhrt"
        ],
        "sbg:latestRevision": 2,
        "sbg:revisionNotes": "renamed output",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#files",
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "$job.inputs.files[1].path",
                "class": "Expression"
              }
            },
            "id": "#first_file"
          }
        ],
        "label": "select first file in array",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1492712213,
        "x": 532.7239379882812,
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 20.915002822875977,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#select_first_file_in_array.first_file"
        }
      ]
    },
    {
      "sbg:x": 240.45729064941406,
      "sbg:y": 447.8442077636719,
      "id": "#plugin_manifest_parse",
      "inputs": [
        {
          "id": "#plugin_manifest_parse.startplugin_json",
          "source": "#run_manifest"
        },
        {
          "id": "#plugin_manifest_parse.manifest_json_parse_passthrough",
          "default": false,
          "source": [
            "#manifest_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/plugin-manifest-parse/9",
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1500589561,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1500589858,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1500603095,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected args",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1500612528,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "fixing glob",
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1507135221,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added passthrough parameter for manifest parse",
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1509470599,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed selecting only first 8 columns",
            "sbg:revision": 5
          },
          {
            "sbg:modifiedOn": 1509810752,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "new parse method",
            "sbg:revision": 6
          },
          {
            "sbg:modifiedOn": 1509810857,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "renamed passthrough",
            "sbg:revision": 7
          },
          {
            "sbg:modifiedOn": 1509813246,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated base command",
            "sbg:revision": 8
          },
          {
            "sbg:modifiedOn": 1509814378,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added stringr",
            "sbg:revision": 9
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1500589561,
        "sbg:job": {
          "inputs": {
            "manifest_json_parse_passthrough": true,
            "startplugin_json": {
              "class": "File",
              "size": 0,
              "path": "/path/to/startplugin.json",
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:publisher": "sbg",
        "inputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#startplugin_json",
            "required": false
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "id": "#manifest_json_parse_passthrough"
          }
        ],
        "sbg:cmdPreview": "cp /path/to/startplugin.json ./typing_manifest.csv",
        "sbg:revision": 9,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/plugin-manifest-parse/9",
        "baseCommand": [
          {
            "engine": "#cwl-js-engine",
            "script": "if($job.inputs.manifest_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./typing_manifest.csv\"}else{\"Rscript plugin_manfiest_parse.R\"} ",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 9,
        "sbg:revisionNotes": "added stringr",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "glob": "typing_manifest.csv"
            },
            "id": "#manifest_csv"
          }
        ],
        "label": "plugin_manifest_parse",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse:latest"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          },
          {
            "fileDef": [
              {
                "fileContent": {
                  "engine": "#cwl-js-engine",
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression"
                },
                "filename": "args.R"
              },
              {
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$typing_manifest) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"typing_manifest.csv\")\n\n# COMMAND ----------",
                "filename": "plugin_manfiest_parse.R"
              }
            ],
            "class": "CreateFileRequirement"
          }
        ],
        "sbg:modifiedOn": 1509814378,
        "x": 240.45729064941406,
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 447.8442077636719,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#plugin_manifest_parse.manifest_csv"
        }
      ]
    },
    {
      "sbg:x": 205.0703582763672,
      "sbg:y": 566.2462158203125,
      "id": "#plugin_control_defs_parse",
      "inputs": [
        {
          "id": "#plugin_control_defs_parse.startplugin_json",
          "source": "#control_definitions"
        },
        {
          "id": "#plugin_control_defs_parse.control_def_json_parse_passthrough",
          "default": false,
          "source": [
            "#control_def_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/plugin-control-defs-parse/4",
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1509812523,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of dave/cgrhpv/plugin-manifest-parse/7",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1509812900,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated",
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1509813156,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated glob",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1509814403,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added stringr",
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1509815990,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected base command",
            "sbg:revision": 4
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1509812523,
        "sbg:job": {
          "inputs": {
            "control_def_json_parse_passthrough": true,
            "startplugin_json": {
              "class": "File",
              "size": 0,
              "path": "/path/to/startplugin.json",
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:publisher": "sbg",
        "inputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#startplugin_json",
            "required": false
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "id": "#control_def_json_parse_passthrough"
          }
        ],
        "sbg:cmdPreview": "cp /path/to/startplugin.json ./control_defs.csv",
        "sbg:revision": 4,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/plugin-control-defs-parse/4",
        "baseCommand": [
          {
            "engine": "#cwl-js-engine",
            "script": "if($job.inputs.control_def_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./control_defs.csv\"}else{\"Rscript plugin_control_defs_parse.R\"} ",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 4,
        "sbg:revisionNotes": "corrected base command",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#startplugin_json",
              "glob": "control_defs.csv"
            },
            "id": "#control_defs"
          }
        ],
        "label": "plugin_control-defs-parse",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse:latest"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          },
          {
            "fileDef": [
              {
                "fileContent": {
                  "engine": "#cwl-js-engine",
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression"
                },
                "filename": "args.R"
              },
              {
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$control_definitions) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"control_defs.csv\")",
                "filename": "plugin_control_defs_parse.R"
              }
            ],
            "class": "CreateFileRequirement"
          }
        ],
        "sbg:modifiedOn": 1509815990,
        "x": 205.0703582763672,
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 566.2462158203125,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#plugin_control_defs_parse.control_defs"
        }
      ]
    },
    {
      "sbg:x": 249.80401611328125,
      "sbg:y": 318.4773864746094,
      "id": "#plugin_report_grouping_parse",
      "inputs": [
        {
          "id": "#plugin_report_grouping_parse.startplugin_json",
          "source": "#report_grouping"
        },
        {
          "id": "#plugin_report_grouping_parse.report_grouping_json_parse_passthrough",
          "default": false,
          "source": [
            "#report_grouping_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/plugin-report-grouping-parse/4",
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1509820752,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of dave/cgrhpv/plugin-control-defs-parse/4",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1509821106,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated codes",
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1509821235,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated R code",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1509821257,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated name",
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1509823186,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected command line",
            "sbg:revision": 4
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1509820752,
        "sbg:job": {
          "inputs": {
            "report_grouping_json_parse_passthrough": false,
            "startplugin_json": {
              "class": "File",
              "size": 0,
              "path": "/path/to/startplugin.json",
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:publisher": "sbg",
        "inputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#startplugin_json",
            "required": false
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "id": "#report_grouping_json_parse_passthrough"
          }
        ],
        "sbg:cmdPreview": "Rscript plugin_report_grouping_parse.R",
        "sbg:revision": 4,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/plugin-report-grouping-parse/4",
        "baseCommand": [
          {
            "engine": "#cwl-js-engine",
            "script": "if($job.inputs.report_grouping_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./report_grouping.csv\"}else{\"Rscript plugin_report_grouping_parse.R\"} ",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 4,
        "sbg:revisionNotes": "corrected command line",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#startplugin_json",
              "glob": "report_grouping.csv"
            },
            "id": "#report_grouping"
          }
        ],
        "label": "plugin_report_grouping_parse",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse:latest"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          },
          {
            "fileDef": [
              {
                "fileContent": {
                  "engine": "#cwl-js-engine",
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression"
                },
                "filename": "args.R"
              },
              {
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$report_grouping_definitions) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"report_grouping.csv\")",
                "filename": "plugin_report_grouping_parse.R"
              }
            ],
            "class": "CreateFileRequirement"
          }
        ],
        "sbg:modifiedOn": 1509823186,
        "x": 249.80401611328125,
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 318.4773864746094,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#plugin_report_grouping_parse.report_grouping"
        }
      ]
    },
    {
      "sbg:x": 984.531005859375,
      "sbg:y": 514.8192749023438,
      "id": "#merge_read_metrics",
      "inputs": [
        {
          "id": "#merge_read_metrics.prefix_for_output",
          "default": "read_metrics"
        },
        {
          "id": "#merge_read_metrics.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.read_metrics"
          ]
        },
        {
          "id": "#merge_read_metrics.input_suffix_and_extension",
          "default": "read_metrics.json"
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "arguments": [
          {
            "separate": true,
            "position": 99,
            "prefix": ">",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression"
            }
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1486841449,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample01.json",
                "secondaryFiles": []
              },
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample02.json",
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1486841449,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1486841686,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1486841826,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1486858801,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1486874369,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1494294732,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "made a better cat app",
            "sbg:revision": 5
          },
          {
            "sbg:modifiedOn": 1495472946,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 6
          },
          {
            "sbg:modifiedOn": 1505248169,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:revision": 7
          },
          {
            "sbg:modifiedOn": 1505248365,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added prefix input",
            "sbg:revision": 8
          }
        ],
        "inputs": [
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#prefix_for_output"
          },
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "id": "#json",
            "sbg:stageInput": "link",
            "required": false
          },
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#input_suffix_and_extension"
          }
        ],
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "sbg:revision": 8,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/cat-json/8",
        "baseCommand": [
          "cat",
          {
            "engine": "#cwl-js-engine",
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 8,
        "sbg:revisionNotes": "added prefix input",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#json",
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "\"*merged.json\"",
                "class": "Expression"
              }
            },
            "id": "#merged_json"
          }
        ],
        "label": "merge read metrics",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1505248365,
        "x": 984.531005859375,
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 514.8192749023438,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#merge_read_metrics.merged_json"
        }
      ]
    },
    {
      "sbg:x": 1048.531005859375,
      "sbg:y": 628.7393798828125,
      "id": "#merge_HPV_types",
      "inputs": [
        {
          "id": "#merge_HPV_types.prefix_for_output",
          "default": "bc2_demultiplex"
        },
        {
          "id": "#merge_HPV_types.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.hpv_types"
          ]
        },
        {
          "id": "#merge_HPV_types.input_suffix_and_extension",
          "default": "bc2_demultiplex.json"
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "arguments": [
          {
            "separate": true,
            "position": 99,
            "prefix": ">",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression"
            }
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1486841449,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample01.json",
                "secondaryFiles": []
              },
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample02.json",
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1486841449,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1486841686,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1486841826,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1486858801,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1486874369,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1494294732,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "made a better cat app",
            "sbg:revision": 5
          },
          {
            "sbg:modifiedOn": 1495472946,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 6
          },
          {
            "sbg:modifiedOn": 1505248169,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:revision": 7
          },
          {
            "sbg:modifiedOn": 1505248365,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added prefix input",
            "sbg:revision": 8
          }
        ],
        "inputs": [
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#prefix_for_output"
          },
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "id": "#json",
            "sbg:stageInput": "link",
            "required": false
          },
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#input_suffix_and_extension"
          }
        ],
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "sbg:revision": 8,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/cat-json/8",
        "baseCommand": [
          "cat",
          {
            "engine": "#cwl-js-engine",
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 8,
        "sbg:revisionNotes": "added prefix input",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#json",
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "\"*merged.json\"",
                "class": "Expression"
              }
            },
            "id": "#merged_json"
          }
        ],
        "label": "merge HPV types",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1505248365,
        "x": 1048.531005859375,
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 628.7393798828125,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#merge_HPV_types.merged_json"
        }
      ]
    },
    {
      "sbg:x": 1131.457763671875,
      "sbg:y": 713.4400024414062,
      "id": "#merge_lineage",
      "inputs": [
        {
          "id": "#merge_lineage.prefix_for_output",
          "default": "lineage"
        },
        {
          "id": "#merge_lineage.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.hpv_lineage"
          ]
        },
        {
          "id": "#merge_lineage.input_suffix_and_extension",
          "default": "hpv_lineage.json"
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "arguments": [
          {
            "separate": true,
            "position": 99,
            "prefix": ">",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression"
            }
          }
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1486841449,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample01.json",
                "secondaryFiles": []
              },
              {
                "class": "File",
                "size": 0,
                "path": "path/to/sample02.json",
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1486841449,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1486841686,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1486841826,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1486858801,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1486874369,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1494294732,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "made a better cat app",
            "sbg:revision": 5
          },
          {
            "sbg:modifiedOn": 1495472946,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 6
          },
          {
            "sbg:modifiedOn": 1505248169,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:revision": 7
          },
          {
            "sbg:modifiedOn": 1505248365,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added prefix input",
            "sbg:revision": 8
          }
        ],
        "inputs": [
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#prefix_for_output"
          },
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "id": "#json",
            "sbg:stageInput": "link",
            "required": false
          },
          {
            "type": [
              "null",
              "string"
            ],
            "id": "#input_suffix_and_extension"
          }
        ],
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "sbg:revision": 8,
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgrhpv/cat-json/8",
        "baseCommand": [
          "cat",
          {
            "engine": "#cwl-js-engine",
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression"
          }
        ],
        "sbg:latestRevision": 8,
        "sbg:revisionNotes": "added prefix input",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#json",
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "\"*merged.json\"",
                "class": "Expression"
              }
            },
            "id": "#merged_json"
          }
        ],
        "label": "merge lineage",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/tidyverse"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1505248365,
        "x": 1131.457763671875,
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 713.4400024414062,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#merge_lineage.merged_json"
        }
      ]
    },
    {
      "inputs": [
        {
          "id": "#Sambamba_View.with_header"
        },
        {
          "id": "#Sambamba_View.valid"
        },
        {
          "id": "#Sambamba_View.subsampling_seed"
        },
        {
          "id": "#Sambamba_View.subsample"
        },
        {
          "id": "#Sambamba_View.sam_input"
        },
        {
          "id": "#Sambamba_View.reserved_threads"
        },
        {
          "id": "#Sambamba_View.regions"
        },
        {
          "id": "#Sambamba_View.ref_filename"
        },
        {
          "id": "#Sambamba_View.output",
          "default": "json"
        },
        {
          "id": "#Sambamba_View.nthreads"
        },
        {
          "id": "#Sambamba_View.mem_mb",
          "source": [
            "#mem_mb"
          ]
        },
        {
          "id": "#Sambamba_View.input",
          "source": "#input"
        },
        {
          "id": "#Sambamba_View.filter"
        },
        {
          "id": "#Sambamba_View.cram_input"
        },
        {
          "id": "#Sambamba_View.count"
        },
        {
          "id": "#Sambamba_View.compression_level"
        }
      ],
      "sbg:x": 682.8693237304688,
      "sbg:y": 790.9749145507812,
      "id": "#Sambamba_View",
      "scatter": "#Sambamba_View.input",
      "run": {
        "sbg:id": "dave/cgrhpv/sambamba-view-0-5-9/2",
        "arguments": [
          {
            "separate": true,
            "position": 3,
            "prefix": "-o",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "{\n  fnameRegex = /^(.*?)(?:\\.([^.]+))?$/;\n  if ($job.inputs.input) \n  {\n  \tfile_path = $job.inputs.input.path;\n  \tbase_name = fnameRegex.exec(file_path)[1];\n  \tfile_name = base_name.replace(/^.*[\\\\\\/]/, '');\n  \n  if ($job.inputs.output == 'sam'){\n  \treturn file_name + '.filtered.sam'\n  }\n  else if ($job.inputs.output == 'bam'){\n  \treturn file_name.concat('.filtered.bam')\n  }\n  else if ($job.inputs.output == 'json'){\n  \treturn file_name.concat('.filtered.json')\n  }\n  else if ($job.inputs.output == 'msgpack'){\n  \treturn file_name.concat('.filtered.msgpack')\n  }\n  else\t{\n  \treturn file_name + '.filtered.sam'\n  }\n  }\n}",
              "class": "Expression"
            }
          }
        ],
        "x": 682.8693237304688,
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:job": {
          "inputs": {
            "nthreads": null,
            "mem_mb": 7,
            "input": {
              "path": "/root/dir/example.bam",
              "secondaryFiles": [
                {
                  "path": ".bai"
                }
              ]
            },
            "subsample": 9.236016917973757,
            "filter": "unmapped",
            "output": "bam",
            "reserved_threads": 8
          },
          "allocatedResources": {
            "cpu": 8,
            "mem": 7
          }
        },
        "description": "Sambamba View efficiently filters a BAM file for alignments satisfying various conditions. It also accesses its SAM header and information about reference sequences. A JSON output is provided to make this data readily available for use with Perl, Python, and Ruby scripts.\n\nBy default, the tool expects a BAM file as an input. In order to work with a SAM file as an input, specify --sam-input command-line option. The tool does NOT automatically detect file format from its extension. Beware that when reading SAM, the tool will skip tags which don't conform to the SAM/BAM specification and set invalid fields to their default values. However, only syntax is checked, use --valid for full validation.",
        "inputs": [
          {
            "sbg:altPrefix": "h",
            "type": [
              "null",
              "boolean"
            ],
            "sbg:category": "Execution",
            "id": "#with_header",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--with-header",
              "sbg:cmdInclude": true
            },
            "description": "Print header before reads (always done for BAM output).",
            "label": "With header"
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "label": "Valid",
            "sbg:category": "Execution",
            "id": "#valid",
            "description": "Output only valid reads."
          },
          {
            "type": [
              "null",
              "int"
            ],
            "label": "Subsampling seed",
            "description": "Set seed for subsampling.",
            "id": "#subsampling_seed",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--subsampling-seed",
              "sbg:cmdInclude": true
            },
            "sbg:category": "Execution"
          },
          {
            "sbg:altPrefix": "s",
            "type": [
              "null",
              "float"
            ],
            "sbg:stageInput": null,
            "sbg:category": "Execution",
            "id": "#subsample",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--subsample=",
              "sbg:cmdInclude": true
            },
            "description": "Subsample reads (read pairs).",
            "label": "Subsample"
          },
          {
            "sbg:altPrefix": "S",
            "type": [
              "null",
              "boolean"
            ],
            "sbg:category": "Execution",
            "id": "#sam_input",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--sam-input",
              "sbg:cmdInclude": true
            },
            "description": "Specify that input is in SAM format.",
            "label": "SAM input"
          },
          {
            "type": [
              "null",
              "int"
            ],
            "label": "Number of threads reserved on the instance",
            "sbg:toolDefaultValue": "1",
            "sbg:stageInput": null,
            "sbg:category": "Execution",
            "id": "#reserved_threads",
            "description": "Number of threads reserved on the instance passed to the scheduler (number of jobs)."
          },
          {
            "sbg:altPrefix": "L",
            "type": [
              "null",
              "File"
            ],
            "required": false,
            "sbg:fileTypes": "BED",
            "sbg:category": "File input.",
            "id": "#regions",
            "inputBinding": {
              "separate": false,
              "position": 0,
              "prefix": "--regions=",
              "secondaryFiles": [],
              "sbg:cmdInclude": true
            },
            "description": "Output only reads overlapping one of regions from the BED file.",
            "label": "Regions"
          },
          {
            "sbg:altPrefix": "T",
            "type": [
              "null",
              "File"
            ],
            "required": false,
            "sbg:fileTypes": "FASTA, FA",
            "sbg:category": "Execution",
            "id": "#ref_filename",
            "inputBinding": {
              "separate": false,
              "position": 0,
              "prefix": "--ref-filename=",
              "secondaryFiles": [],
              "sbg:cmdInclude": true
            },
            "description": "Specify reference for writing CRAM.",
            "label": "Reference"
          },
          {
            "sbg:altPrefix": "-f",
            "type": [
              {
                "type": "enum",
                "symbols": [
                  "sam",
                  "bam",
                  "cram",
                  "json"
                ],
                "name": "output"
              }
            ],
            "sbg:category": "Execution",
            "id": "#output",
            "inputBinding": {
              "separate": false,
              "position": 1,
              "prefix": "--format=",
              "sbg:cmdInclude": true
            },
            "description": "Specify which format to use for output (default is SAM).",
            "label": "Output format"
          },
          {
            "sbg:altPrefix": "-t",
            "type": [
              "null",
              "int"
            ],
            "sbg:toolDefaultValue": "8",
            "sbg:category": "Execution",
            "id": "#nthreads",
            "inputBinding": {
              "separate": false,
              "position": 0,
              "prefix": "--nthreads=",
              "valueFrom": {
                "engine": "#cwl-js-engine",
                "script": "{\n  if ($job.inputs.nthreads)\n    return $job.inputs.nthreads\n  else\n    return 8\n}",
                "class": "Expression"
              },
              "sbg:cmdInclude": true
            },
            "description": "Number of threads to use.",
            "label": "Number of threads"
          },
          {
            "type": [
              "null",
              "int"
            ],
            "label": "Memory in MB",
            "sbg:toolDefaultValue": "1024",
            "sbg:stageInput": null,
            "sbg:category": "Execution",
            "id": "#mem_mb",
            "description": "Memory in MB."
          },
          {
            "type": [
              "File"
            ],
            "label": "Input",
            "sbg:fileTypes": "BAM, SAM",
            "sbg:category": "Inputs",
            "id": "#input",
            "inputBinding": {
              "separate": true,
              "sbg:cmdInclude": true,
              "itemSeparator": " ",
              "position": 2,
              "secondaryFiles": [
                ".bai"
              ]
            },
            "description": "BAM or SAM file.",
            "required": true
          },
          {
            "sbg:altPrefix": "-F",
            "type": [
              "null",
              "string"
            ],
            "sbg:category": "Basic Options",
            "id": "#filter",
            "inputBinding": {
              "separate": true,
              "itemSeparator": " ",
              "sbg:cmdInclude": true,
              "position": 0,
              "prefix": "--filter",
              "valueFrom": {
                "engine": "#cwl-js-engine",
                "script": "{\n  if ($job.inputs.filter)\n  {\n  \treturn '\"'.concat($job.inputs.filter, '\"')\n  }\n}",
                "class": "Expression"
              }
            },
            "description": "Set custom filter for alignments.",
            "label": "Filter"
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "label": "CRAM input",
            "description": "Specify that input is in CRAM format.",
            "id": "#cram_input",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--cram-input",
              "sbg:cmdInclude": true
            },
            "sbg:category": "Execution"
          },
          {
            "sbg:altPrefix": "c",
            "type": [
              "null",
              "boolean"
            ],
            "sbg:category": "Execution",
            "id": "#count",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--count",
              "sbg:cmdInclude": true
            },
            "description": "Output to stdout only count of matching records, hHI are ignored.",
            "label": "Count"
          },
          {
            "sbg:altPrefix": "l",
            "type": [
              "null",
              "int"
            ],
            "sbg:category": "Execution",
            "id": "#compression_level",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "prefix": "--compression-level",
              "sbg:cmdInclude": true
            },
            "description": "Specify compression level (from 0 to 9, works only for BAM output).",
            "label": "Compression level"
          }
        ],
        "sbg:cmdPreview": "/sambamba_v0.6.6 view --format=bam  /root/dir/example.bam -o example.filtered.bam",
        "sbg:revision": 2,
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:toolAuthor": "Artem Tarasov",
        "id": "dave/cgrhpv/sambamba-view-0-5-9/2",
        "sbg:latestRevision": 2,
        "sbg:revisionNotes": "corrected command line and switch to typeseqer docker",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "label": "BAM file",
            "sbg:fileTypes": "BAM, SAM, JSON, MSGPACK",
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#input",
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "{\n  fnameRegex = /^(.*?)(?:\\.([^.]+))?$/;\n  file_path = $job.inputs.input.path;\n  base_name = fnameRegex.exec(file_path)[1];\n  file_name = base_name.replace(/^.*[\\\\\\/]/, '');\n  \n  if ($job.inputs.output == 'sam'){\n  \treturn file_name + '.filtered.sam'\n  }\n  else if ($job.inputs.output == 'bam'){\n  \treturn file_name.concat('.filtered.bam')\n  }\n  else if ($job.inputs.output == 'json'){\n  \treturn file_name.concat('.filtered.json')\n  }\n  else if ($job.inputs.output == 'msgpack'){\n  \treturn file_name.concat('.filtered.msgpack')\n  }\n  else\t{\n  \treturn file_name + '.filtered.sam'\n  }\n}",
                "class": "Expression"
              }
            },
            "id": "#filtered",
            "description": "Bam file."
          }
        ],
        "sbg:createdOn": 1485478878,
        "label": "Sambamba View",
        "sbg:links": [
          {
            "label": "Homepage",
            "id": "http://lomereiter.github.io/sambamba/docs/sambamba-view.html"
          },
          {
            "label": "Source code",
            "id": "https://github.com/lomereiter/sambamba"
          },
          {
            "label": "Wiki",
            "id": "https://github.com/lomereiter/sambamba/wiki"
          },
          {
            "label": "Download",
            "id": "https://github.com/lomereiter/sambamba/releases/tag/v0.5.9"
          },
          {
            "label": "Publication",
            "id": "http://lomereiter.github.io/sambamba/docs/sambamba-view.html"
          }
        ],
        "baseCommand": [
          "/sambamba_v0.6.6",
          "view"
        ],
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": {
              "engine": "#cwl-js-engine",
              "script": "{\n  if ($job.inputs.reserved_threads) {\n    \n    return $job.inputs.reserved_threads\n    \n  } else if ($job.inputs.nthreads) {\n    \n    return $job.inputs.nthreads\n    \n  } else {\n    \n    return 1\n  }\n  \n}",
              "class": "Expression"
            }
          },
          {
            "class": "sbg:MemRequirement",
            "value": {
              "engine": "#cwl-js-engine",
              "script": "{\n  if ($job.inputs.mem_mb) {\n    \n    return $job.inputs.mem_mb\n    \n  } else {\n    \n    return 1024\n    \n  }\n  \n}",
              "class": "Expression"
            }
          },
          {
            "dockerImageId": "59e577b13d5d",
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/typeseqer:latest"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1520743858,
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1485478878,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of dave/cgrwgs/sambamba-view-0-5-9/1",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1486834921,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1520743858,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected command line and switch to typeseqer docker",
            "sbg:revision": 2
          }
        ],
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 790.9749145507812,
        "sbg:sbgMaintained": false,
        "sbg:license": "GNU General Public License v2.0 only",
        "sbg:categories": [
          "SAM/BAM-Processing"
        ],
        "sbg:createdBy": "dave",
        "class": "CommandLineTool",
        "sbg:toolkit": "Sambamba",
        "sbg:toolkitVersion": "0.5.9"
      },
      "outputs": [
        {
          "id": "#Sambamba_View.filtered"
        }
      ]
    },
    {
      "sbg:x": 706.9485473632812,
      "sbg:y": 48.294185638427734,
      "id": "#SAMtools_extract_SAM_BAM_header",
      "inputs": [
        {
          "id": "#SAMtools_extract_SAM_BAM_header.input_bam_or_sam_file",
          "source": "#select_first_file_in_array.first_file"
        }
      ],
      "run": {
        "sbg:id": "dave/cgrhpv/samtools-extract-bam-header-1-3/3",
        "arguments": [
          {
            "separate": true,
            "position": 2,
            "prefix": "-o",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "{\n filepath = $job.inputs.input_bam_or_sam_file.path\n\n filename = filepath.split(\"/\").pop();\n\n file_dot_sep = filename.split(\".\");\n file_ext = file_dot_sep[file_dot_sep.length-1];\n\n new_filename = filename.substr(0,filename.lastIndexOf(\".\"));\n \n extension = '.txt'\n             \n return new_filename + extension; \n}",
              "class": "Expression"
            }
          },
          {
            "separate": true,
            "position": 1,
            "prefix": "",
            "valueFrom": {
              "engine": "#cwl-js-engine",
              "script": "{\nreturn '-H'\n}",
              "class": "Expression"
            }
          }
        ],
        "x": 706.9485473632812,
        "sbg:projectName": "cgrHPV",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:job": {
          "inputs": {
            "input_bam_or_sam_file": {
              "class": "File",
              "size": 0,
              "path": "input_bam_or_sam_file.bam",
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 1000
          }
        },
        "description": "Extract the header from the alignment file in SAM or BAM formats.",
        "inputs": [
          {
            "type": [
              "File"
            ],
            "label": "BAM or SAM input file",
            "sbg:fileTypes": "BAM, SAM",
            "sbg:category": "File input",
            "id": "#input_bam_or_sam_file",
            "inputBinding": {
              "separate": true,
              "sbg:cmdInclude": true,
              "position": 0,
              "secondaryFiles": []
            },
            "description": "BAM or SAM input file.",
            "required": true
          }
        ],
        "sbg:cmdPreview": "samtools view  input_bam_or_sam_file.bam  -H -o input_bam_or_sam_file.txt",
        "sbg:revision": 3,
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:project": "dave/cgrhpv",
        "sbg:modifiedBy": "dave",
        "sbg:toolAuthor": "Heng Li/Sanger Institute,  Bob Handsaker/Broad Institute, James Bonfield/Sanger Institute,",
        "id": "dave/cgrhpv/samtools-extract-bam-header-1-3/3",
        "sbg:latestRevision": 3,
        "sbg:revisionNotes": "cgrlab/typeseqer:latest",
        "outputs": [
          {
            "type": [
              "File"
            ],
            "label": "Output header",
            "sbg:fileTypes": "TXT",
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#input_bam_or_sam_file",
              "glob": "*.txt"
            },
            "id": "#output_header_file",
            "description": "Output header."
          }
        ],
        "sbg:createdOn": 1492714234,
        "label": "SAMtools extract SAM/BAM header",
        "sbg:links": [
          {
            "label": "Homepage",
            "id": "http://www.htslib.org"
          },
          {
            "label": "Source Code",
            "id": "https://github.com/samtools/"
          },
          {
            "label": "Download",
            "id": "https://sourceforge.net/projects/samtools/files/samtools/"
          },
          {
            "label": "Publication",
            "id": "http://www.ncbi.nlm.nih.gov/pubmed/19505943"
          },
          {
            "label": "Documentation",
            "id": "http://www.htslib.org/doc/samtools.html"
          },
          {
            "label": "Wiki",
            "id": "http://www.htslib.org"
          }
        ],
        "baseCommand": [
          "samtools",
          "view"
        ],
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/typeseqer:latest"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          }
        ],
        "sbg:modifiedOn": 1520717721,
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1492714234,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of admin/sbg-public-data/samtools-extract-bam-header-1-3/9",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1492714376,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "no changes...just want to save a non-copy version in this project",
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1495125186,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed aws instance hint",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1520717721,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "cgrlab/typeseqer:latest",
            "sbg:revision": 3
          }
        ],
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 48.294185638427734,
        "sbg:sbgMaintained": false,
        "sbg:license": "BSD License, MIT License",
        "sbg:categories": [
          "SAM/BAM-Processing"
        ],
        "sbg:createdBy": "dave",
        "class": "CommandLineTool",
        "sbg:toolkit": "SAMtools",
        "sbg:toolkitVersion": "v1.3"
      },
      "outputs": [
        {
          "id": "#SAMtools_extract_SAM_BAM_header.output_header_file"
        }
      ]
    },
    {
      "sbg:x": 1391.0024797467852,
      "sbg:y": 209.73213434325777,
      "id": "#ion_typeseqer_report",
      "inputs": [
        {
          "id": "#ion_typeseqer_report.startplugin_json",
          "source": "#run_manifest"
        },
        {
          "id": "#ion_typeseqer_report.scaling_table",
          "source": "#scaling_table"
        },
        {
          "id": "#ion_typeseqer_report.run_manifest",
          "source": "#plugin_manifest_parse.manifest_csv"
        },
        {
          "id": "#ion_typeseqer_report.report_grouping_csv",
          "source": "#plugin_report_grouping_parse.report_grouping"
        },
        {
          "id": "#ion_typeseqer_report.read_metrics_json",
          "source": "#merge_read_metrics.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.pos_neg_filtering_criteria_path",
          "source": "#pos_neg_filtering_criteria_path"
        },
        {
          "id": "#ion_typeseqer_report.parameter_file",
          "source": "#parameter_file"
        },
        {
          "id": "#ion_typeseqer_report.lineage_table_json",
          "source": "#merge_lineage.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.lineage_reference_table",
          "source": "#lineage_reference_table"
        },
        {
          "id": "#ion_typeseqer_report.is_torrent_server",
          "source": [
            "#is_torrent_server"
          ]
        },
        {
          "id": "#ion_typeseqer_report.hpv_types_json",
          "source": "#merge_HPV_types.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.control_defs",
          "source": "#plugin_control_defs_parse.control_defs"
        },
        {
          "id": "#ion_typeseqer_report.bam_header_file",
          "source": "#SAMtools_extract_SAM_BAM_header.output_header_file"
        }
      ],
      "run": {
        "sbg:id": "dave/cgr-apps/ion-typeseqer-report/22",
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1526931198,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "Copy of dave/rd111-typing-v2/ion-typeseqer-report/5",
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1526931368,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "fixing num_types_positive in grouped samples only matrix",
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1527090879,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added conditional display",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1527192146,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "fixing num types pos for grouped output",
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1527870418,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added lineage table to report",
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1527870640,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added lineage table output glob",
            "sbg:revision": 5
          },
          {
            "sbg:modifiedOn": 1527871115,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added lineage refernce table input",
            "sbg:revision": 6
          },
          {
            "sbg:modifiedOn": 1528136584,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added safe lineage plot funciton",
            "sbg:revision": 7
          },
          {
            "sbg:modifiedOn": 1528139518,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed last line of rscript syntax error",
            "sbg:revision": 8
          },
          {
            "sbg:modifiedOn": 1528168462,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added is_tn",
            "sbg:revision": 9
          },
          {
            "sbg:modifiedOn": 1528910819,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed min lineage read count and create lineage output params b/c ot suing them also added much code docs",
            "sbg:revision": 10
          },
          {
            "sbg:modifiedOn": 1529006928,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "rm lineage read count from args.R",
            "sbg:revision": 11
          },
          {
            "sbg:modifiedOn": 1529009455,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected args.R",
            "sbg:revision": 12
          },
          {
            "sbg:modifiedOn": 1529264555,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "better lineage matrix and plots",
            "sbg:revision": 13
          },
          {
            "sbg:modifiedOn": 1530021192,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "switched to TypeSeqer package",
            "sbg:revision": 14
          },
          {
            "sbg:modifiedOn": 1530026494,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected final_pn_matrix cp end cmd",
            "sbg:revision": 15
          },
          {
            "sbg:modifiedOn": 1530036925,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "switched to typeseqerd2 docker",
            "sbg:revision": 16
          },
          {
            "sbg:modifiedOn": 1530036999,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "put cp pdf back in for ts",
            "sbg:revision": 17
          },
          {
            "sbg:modifiedOn": 1530046314,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed links from ts tn html block",
            "sbg:revision": 18
          },
          {
            "sbg:modifiedOn": 1530099867,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "",
            "sbg:revision": 19
          },
          {
            "sbg:modifiedOn": 1531490619,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "updated R package name",
            "sbg:revision": 20
          },
          {
            "sbg:modifiedOn": 1531494329,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "fixing R package name",
            "sbg:revision": 21
          },
          {
            "sbg:modifiedOn": 1531515784,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "final_2018071301",
            "sbg:revision": 22
          }
        ],
        "sbg:projectName": "CGR_Apps",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1526931198,
        "sbg:job": {
          "inputs": {
            "parameter_file": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/parameter_file.csv"
            },
            "pos_neg_filtering_criteria_path": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/2017-06-11_Pos-Neg_matrix_filtering_criteria_RefTable_v3.txt"
            },
            "is_torrent_server": true,
            "read_metrics_json": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/read_metrics.json"
            },
            "bam_header_file": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/header_file.txt"
            },
            "min_lineage_read_count": 5,
            "scaling_table": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/scaling_table.csv"
            },
            "run_manifest": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "path/to/run_manifest.csv"
            },
            "hpv_types_json": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "path/to/merged_hpv_types.json"
            },
            "create_lineage_table_output": true,
            "lineage_table_json": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "path/to/merged_lineage.json"
            },
            "report_grouping_csv": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/report_grouping_csv.ext"
            },
            "control_defs": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/control_defs.csv"
            },
            "startplugin_json": {
              "secondaryFiles": [],
              "class": "File",
              "size": 0,
              "path": "/path/to/startplugin_json.ext"
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 2000
          }
        },
        "sbg:publisher": "sbg",
        "inputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#startplugin_json",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "sbg:fileTypes": "CSV",
            "id": "#scaling_table",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#run_manifest",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#report_grouping_csv",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#read_metrics_json",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#pos_neg_filtering_criteria_path",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#parameter_file",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#lineage_table_json",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "label": "lineage reference table",
            "id": "#lineage_reference_table",
            "required": false
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "id": "#is_torrent_server",
            "sbg:stageInput": null
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#hpv_types_json",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#control_defs",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#bam_header_file",
            "streamable": false,
            "default": "",
            "required": false
          }
        ],
        "sbg:cmdPreview": "Rscript -e 'require(rmarkdown); render(\"TypeSeqer_report_pdf.R\"); system(paste0(\"cp TypeSeqer_report_pdf.pdf \", pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\")); render(\"hpv_typing_html.R\") ' 1>&2",
        "sbg:revision": 22,
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:image_url": null,
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgr-apps/ion-typeseqer-report/22",
        "sbg:latestRevision": 22,
        "sbg:revisionNotes": "final_2018071301",
        "outputs": [
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "\"*samples_only_matrix.csv\""
              }
            },
            "id": "#samples_only_matrix"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "'*read_metrics.csv'"
              }
            },
            "streamable": false,
            "default": "",
            "id": "#read_metrics_csv"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "\"*pn_matrix.csv\""
              }
            },
            "id": "#pos_neg_matrix"
          },
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "\"*plot_data.csv\""
              }
            },
            "id": "#plot_data"
          },
          {
            "type": [
              "null",
              {
                "type": "array",
                "items": "File"
              }
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "'*pdf'"
              }
            },
            "id": "#pdf_report"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "label": "lineage table",
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#hpv_types_json",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "\"*lineage_matrix.csv\""
              }
            },
            "id": "#lineage_table"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#run_manifest",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "'*hpv_read_counts_matrix.csv'"
              }
            },
            "streamable": false,
            "default": "",
            "id": "#hpv_read_counts_matrix"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#hpv_types_json",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "\"*failed_samples_matrix.csv\""
              }
            },
            "id": "#failed_samples_matrix"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "sbg:inheritMetadataFrom": "#hpv_types_json",
              "glob": {
                "engine": "#cwl-js-engine",
                "class": "Expression",
                "script": "'*control_results.csv'"
              }
            },
            "id": "#control_matrix"
          }
        ],
        "label": "hpv_typing_report",
        "baseCommand": [
          "Rscript",
          "-e",
          "'require(devtools);",
          "require(rmarkdown);",
          {
            "engine": "#cwl-js-engine",
            "class": "Expression",
            "script": "\nif ($job.inputs.is_torrent_server) {\n    'system(paste0(\"cp \", system.file(\"extdata/ion_report\", \"Ion_Torrent_report.R\", package = \"TypeSeqHPV\"),\" ./\")); render(\"Ion_Torrent_report.R\"); system(paste0(\"cp Ion_Torrent_report.pdf \", final_pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\")); render(\"hpv_typing_html.R\")'}\n\nelse {'run_type = \"not_ts\"; install_github(\"cgrlab/TypeSeqHPV\", force=TRUE); system(paste0(\"cp \", system.file(\"extdata/ion_report\", \"Ion_Torrent_report.R\", package = \"TypeSeqHPV\"),\" ./\")); render(\"Ion_Torrent_report.R\"); system(paste0(\"mv Ion_Torrent_report.pdf \", final_pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\"))'}"
          },
          "'",
          "1>&2"
        ],
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 2000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/typeseqhpv:final_2018071301"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          },
          {
            "fileDef": [
              {
                "fileContent": {
                  "engine": "#cwl-js-engine",
                  "class": "Expression",
                  "script": "'# get args \\n\\\nargs_control_defs = \"'+$job.inputs.control_defs.path+'\" \\n\\\nargs_run_manifest_path =  \"'+$job.inputs.run_manifest.path+'\" \\n\\\nargs_bam_header_path =  \"'+$job.inputs.bam_header_file.path+'\" \\n\\\nargs_read_metrics_path = \"'+$job.inputs.read_metrics_json.path+'\" \\n\\\nargs_pos_neg_filtering_criteria_path = \"'+$job.inputs.pos_neg_filtering_criteria_path.path+'\" \\n\\\nargs_hpv_types_path = \"'+$job.inputs.hpv_types_json.path+'\" \\n\\\nargs_lineage_table_path = \"'+$job.inputs.lineage_table_json.path+'\" \\n\\\nargs_scaling_table = \"'+$job.inputs.scaling_table.path+'\" \\n\\\nargs_parameter_file_path = \"'+$job.inputs.parameter_file.path+'\" \\n\\\nargs_is_torrent_server = \"'+$job.inputs.is_torrent_server+'\" \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\" \\n\\\nargs_lineage_reference_path = \"'+$job.inputs.lineage_reference_table.path+'\" \\n\\\nargs_custom_groups_path = \"'+$job.inputs.report_grouping_csv.path+'\"';"
                },
                "filename": "args.R"
              },
              {
                "fileContent": "#' ---\n#' title: TypeSeqer HPV Typing Report\n#' author: \" \"\n#' date: \"`r format(Sys.time(), '%d %B, %Y')`\"\n#' output:\n#'  html_document\n#' ---\n\n\n#+ load packages, echo=FALSE, include = FALSE\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(jsonlite)\nlibrary(scales)\nsessionInfo()\n\n\n#+ get args, echo=FALSE, include = FALSE\nread_lines(\"args.R\") %>% \nwriteLines()\nsource(\"args.R\")\n\n\n#+ determine run type, echo=FALSE\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nrun_type = plugin_json$runplugin$run_type\n\n#' # {.tabset}\n#' ## Analysis Output\n\n#+ full run, echo=FALSE, results='asis', eval=run_type!=\"thumbnail\"\n\ncat('\n\n<a href=\"./TypeSeqer_QC_report.pdf\" target=\"_blank\">QC Report</a>\n  \n[TypeSeqer Report Files](./TypeSeqer_Report_Files.zip)  \n  \n\n  \n')\n\n#+ thumbnail run, echo=FALSE, results='asis', eval=run_type==\"thumbnail\"\ncat('\n\nThumbnail data insufficient for typing analysis.  \n    \nPlease see full report.\n\n')",
                "filename": "hpv_typing_html.R"
              }
            ],
            "class": "CreateFileRequirement"
          }
        ],
        "sbg:modifiedOn": 1531515784,
        "x": 1391.0024797467852,
        "cwlVersion": "sbg:draft-2",
        "sbg:project": "dave/cgr-apps",
        "sbg:validationErrors": [],
        "y": 209.73213434325777,
        "sbg:createdBy": "dave",
        "class": "CommandLineTool",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#ion_typeseqer_report.samples_only_matrix"
        },
        {
          "id": "#ion_typeseqer_report.read_metrics_csv"
        },
        {
          "id": "#ion_typeseqer_report.pos_neg_matrix"
        },
        {
          "id": "#ion_typeseqer_report.plot_data"
        },
        {
          "id": "#ion_typeseqer_report.pdf_report"
        },
        {
          "id": "#ion_typeseqer_report.lineage_table"
        },
        {
          "id": "#ion_typeseqer_report.hpv_read_counts_matrix"
        },
        {
          "id": "#ion_typeseqer_report.failed_samples_matrix"
        },
        {
          "id": "#ion_typeseqer_report.control_matrix"
        }
      ]
    },
    {
      "inputs": [
        {
          "id": "#ion_torrent_typing_read_processor_1.parameter_file",
          "source": "#parameter_file"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.lineage_reference_table",
          "source": "#lineage_reference_table"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.create_lineage_table_output"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.barcode_list",
          "source": "#barcode_list"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.bam_json",
          "source": "#Sambamba_View.filtered"
        }
      ],
      "sbg:x": 852.1156005859375,
      "sbg:y": 670.492431640625,
      "id": "#ion_torrent_typing_read_processor_1",
      "scatter": "#ion_torrent_typing_read_processor_1.bam_json",
      "run": {
        "sbg:id": "dave/cgr-apps/ion-torrent-typing-read-processor/5",
        "arguments": [
          {
            "separate": true,
            "position": 100,
            "valueFrom": "1>&2"
          }
        ],
        "sbg:projectName": "CGR_Apps",
        "sbg:contributors": [
          "dave"
        ],
        "sbg:createdOn": 1526505561,
        "sbg:job": {
          "inputs": {
            "create_lineage_table_output": true,
            "parameter_file": {
              "class": "File",
              "size": 0,
              "path": "/path/to/parameter_file.ext",
              "secondaryFiles": []
            },
            "barcode_list": {
              "class": "File",
              "size": 0,
              "path": "/path/to/barcode_list.ext",
              "secondaryFiles": []
            },
            "bam_json": {
              "class": "File",
              "size": 0,
              "path": "path/to/ IonXpress_075_Auto_user_S5XL-0039-25-2017-01-10_RD111_HPV-T_T163_SUCCEED_104_005.split.json",
              "secondaryFiles": []
            },
            "lineage_reference_table": {
              "class": "File",
              "size": 0,
              "path": "/path/to/lineage_reference_table.ext",
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "cpu": 1,
            "mem": 2000
          }
        },
        "sbg:revisionsInfo": [
          {
            "sbg:modifiedOn": 1526505561,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 0
          },
          {
            "sbg:modifiedOn": 1526505586,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": null,
            "sbg:revision": 1
          },
          {
            "sbg:modifiedOn": 1527619937,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "added lineage code back in",
            "sbg:revision": 2
          },
          {
            "sbg:modifiedOn": 1527625377,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "corrected lineage path args.R",
            "sbg:revision": 3
          },
          {
            "sbg:modifiedOn": 1527693022,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "removed and args.R typo",
            "sbg:revision": 4
          },
          {
            "sbg:modifiedOn": 1527697061,
            "sbg:modifiedBy": "dave",
            "sbg:revisionNotes": "correteing args.R issue",
            "sbg:revision": 5
          }
        ],
        "inputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "streamable": false,
            "default": "",
            "id": "#parameter_file",
            "inputBinding": {
              "separate": true,
              "sbg:cmdInclude": true,
              "position": 0,
              "secondaryFiles": []
            },
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#lineage_reference_table",
            "streamable": false,
            "default": "",
            "required": false
          },
          {
            "type": [
              "null",
              "boolean"
            ],
            "streamable": false,
            "default": "",
            "id": "#create_lineage_table_output",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true
            },
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "id": "#barcode_list",
            "required": false
          },
          {
            "type": [
              "null",
              "File"
            ],
            "streamable": false,
            "default": "",
            "id": "#bam_json",
            "inputBinding": {
              "separate": true,
              "sbg:cmdInclude": true,
              "position": 0,
              "secondaryFiles": []
            },
            "required": false
          }
        ],
        "sbg:cmdPreview": "Rscript ion_torrent_typing_read_processor.R  1>&2",
        "baseCommand": [
          "Rscript",
          "-e",
          "'is_batch=\"true\";",
          "source(\"ion_torrent_typing_read_processor.R\")'"
        ],
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:revision": 5,
        "sbg:project": "dave/cgr-apps",
        "sbg:modifiedBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "id": "dave/cgr-apps/ion-torrent-typing-read-processor/5",
        "sbg:latestRevision": 5,
        "sbg:revisionNotes": "correteing args.R issue",
        "outputs": [
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "'*read_metrics.json'",
                "class": "Expression"
              }
            },
            "streamable": false,
            "default": "",
            "id": "#read_metrics"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "'*bc2_demultiplex.json'",
                "class": "Expression"
              }
            },
            "streamable": false,
            "default": "",
            "id": "#hpv_types"
          },
          {
            "type": [
              "null",
              "File"
            ],
            "outputBinding": {
              "glob": {
                "engine": "#cwl-js-engine",
                "script": "'*_hpv_lineage.json'",
                "class": "Expression"
              }
            },
            "streamable": false,
            "default": "",
            "id": "#hpv_lineage"
          }
        ],
        "label": "ion_torrent_typing_read_processor",
        "class": "CommandLineTool",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 2000
          },
          {
            "class": "DockerRequirement",
            "dockerPull": "cgrlab/typeseqer:0.5.02"
          }
        ],
        "requirements": [
          {
            "id": "#cwl-js-engine",
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "class": "DockerRequirement",
                "dockerPull": "rabix/js-engine"
              }
            ]
          },
          {
            "fileDef": [
              {
                "fileContent": {
                  "engine": "#cwl-js-engine",
                  "script": "\n'# get args \\n\\\nargs_create_lineage_table_output = \"'+$job.inputs.create_lineage_table_output+'\" \\n\\\nargs_bam_json = data_frame(path = \"'+$job.inputs.bam_json.path+'\", name = \"'+$job.inputs.bam_json.path.split(\"/\").reverse()[0].split(\".split.json\")[0]+'\") \\n\\\nargs_A_barcode = \"A'+$job.inputs.bam_json.path.split(\"IonXpress_\").reverse()[0].substr(1,2)+'\" \\n\\\nargs_lineage_reference_path = \"'+$job.inputs.lineage_reference_table.path+'\" \\n\\\nargs_barcode_list = \"'+$job.inputs.barcode_list.path+'\" \\n\\\nargs_parameter_file = data_frame(path = \"'+$job.inputs.parameter_file.path+'\")'",
                  "class": "Expression"
                },
                "filename": "args.R"
              },
              {
                "fileContent": "# Databricks notebook source\n# load packages\n\nif (!exists(\"is_batch\")) {library(SparkR)}\n\ndynamic_require = function(x){\n  for( i in x ){\n    #  require returns TRUE invisibly if it was able to load package\n    if( ! require( i , character.only = TRUE ) ){\n      #  If package was not able to be loaded then re-install\n      install.packages( i , dependencies = TRUE )\n      #  Load package after installing\n      require( i , character.only = TRUE )\n    }\n  }\n}\n\ndynamic_require(c(\"tidyverse\",\n                  \"jsonlite\"))\n\ndynamic_require_bioc = function(x){\n  for( i in x ){\n    #  require returns TRUE invisibly if it was able to load package\n    if( ! require( i , character.only = TRUE ) ){\n      #  If package was not able to be loaded then re-install\n      source(\"https://bioconductor.org/biocLite.R\")\n      biocLite(i)\n      install.packages( i , dependencies = TRUE )\n      #  Load package after installing\n      require( i , character.only = TRUE )\n    }\n  }\n}\n\ndynamic_require_bioc(\"GenomicAlignments\")\n\nsessionInfo()\n\n\n# COMMAND ----------\n\nif (!exists(\"is_batch\")) {\n\nsystem(\"rm -r /databricks/driver/TypeSeqerHpvIon\") \nsystem(\"mkdir /databricks/driver/TypeSeqerHpvIon\")\nsetwd(\"/databricks/driver/TypeSeqerHpvIon\")  \n  \nargs_create_lineage_table_output = \"true\" \n\nargs_bam_json = data_frame(path = \"/databricks/driver/TypeSeqerHpvIon/IX68_200k.json\", name = \"IonXpress_068_rawlib.filtered.json\") \n\nargs_A_barcode = \"A68\" \n\nargs_lineage_reference_path=\"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/20180121_lineage_reference_table_and_filters_2.csv\"\n\nargs_barcode_list = \"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/barcodeList_v1.csv\" \n\nargs_parameter_file = data_frame(path = \"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/hpv_types_MQ_min_max_len_filters_JUNE2017_30-10bpLen_v6.txt\")\n  \nsystem(\"touch args.R\")\n  \n#create a smaller version of the raw reads bam json\n\nsystem(\"head -n 200000 /dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/IonXpress_068_rawlib.filtered.json > /databricks/driver/TypeSeqerHpvIon/IX68_200k.json\")\n\n}\n\n# COMMAND ----------\n\nread_lines(\"args.R\") %>% \nwriteLines()\nsource(\"args.R\")\n\n# COMMAND ----------\n\n# MAGIC %md\n# MAGIC \n# MAGIC ##Below are 2 functions used in this read processor app.\n# MAGIC \n# MAGIC * Read Metrics  \n# MAGIC * Barcode 2 demultiplex (includes lineage detectin inside this function)\n\n# COMMAND ----------\n\n# here are 3 funcions that are used in this run processor app\nts_read_metrics = function(bam_json_input, parameters_df_input){\n\n# only used in a jsonlite streaming function\n\nif(\"ZA\" %in% colnames(bam_json_input$tags)){ ZA_df = data_frame(ZA = bam_json_input$tags$ZA)}else{ZA_df = data_frame(ZA = rep(0, length(bam_json_input$qname)))}\n\nbam_json = bam_json_input %>%\nselect(qname, HPV_Type = rname, seq, mapq, cigar) %>%\nmutate(page_num = page) %>%\nbind_cols(ZA_df) %>%\nmutate(ZA = ifelse(is.na(ZA), 0, ZA)) %>%\nmutate(bc1_id = args_A_barcode) %>%\nmutate(file_name = args_bam_json$name) %>%\nmutate(total_reads = n()) %>%\n  \n# left join with parameters file that contians qualifying criteria for each hpv contig\nleft_join(parameters_df_input) %>%\n  \n# mapq greater than 0 - count multi-mapped / 0 mapping quaity and filter becuase cigar will be 0 so we cannot include past here\nmutate(mapq_greater_than_zero = ifelse(mapq != 0, 1, 0)) %>%\nmutate(mapq_greater_than_zero = sum(mapq_greater_than_zero)) %>%\nfilter(mapq > 0) %>%\n  \n# ZA\nmutate(pass_za = ifelse(str_length(seq) == ZA, 1, 0)) %>%\n  \n# aligned length within specific parameters\nmutate(cigar_seq = as.character(sequenceLayer(DNAStringSet(seq), cigar))) %>%\nmutate(cigar_len = str_length(cigar_seq)) %>%\nmutate(pass_seq_length = ifelse(\n  cigar_len >= min_len, ifelse(\n  cigar_len <= max_len, ifelse(\n  pass_za == 1, 1, 0), 0), 0)) %>%\n  \n# mapq is greater than specific parameters\nmutate(pass_mapq = ifelse(mapq >= min_mq, 1, 0)) %>%\n\nmutate(pass_mapq = ifelse(\n  mapq >= min_mq, ifelse(\n  pass_seq_length == 1, ifelse(\n  pass_za == 1, 1, 0), 0), 0)) %>%\n\n# sum up\nmutate(pass_za = sum(pass_za)) %>%\nmutate(pass_seq_length = sum(pass_seq_length)) %>%\nmutate(pass_mapq = sum(pass_mapq)) %>%\n# select the final colums and compress down to 1 row with distinct()\nselect(page_num, bc1_id, total_reads, mapq_greater_than_zero, pass_za, pass_seq_length, pass_mapq, file_name) %>%\ndistinct()\n  \n    \n}\n\n# COMMAND ----------\n\nts_demultiplex_bc2 = function(bam_json_input, parameters_df_input, barcode_list_input){\n\nif(\"ZA\" %in% colnames(bam_json_input$tags)){ ZA_df = data_frame(ZA = bam_json_input$tags$ZA)}else{ZA_df = data_frame(ZA = rep(0, length(bam_json_input$qname)))}\n\nbam_json = bam_json_input %>%\nselect(qname, HPV_Type = rname, seq, mapq, cigar) %>%\nmutate(page_num = page) %>%\nbind_cols(ZA_df) %>%\nmutate(ZA = ifelse(is.na(ZA), 0, ZA)) %>%\nmutate(bc1_id = args_A_barcode) %>%\nmutate(file_name = args_bam_json$name) %>%\nmutate(total_reads = n()) %>%\nmutate(seq_length = str_length(seq)) %>%\nleft_join(parameters_df) %>%\n\n# Filter 1 - mapq > 0 ----\nfilter(mapq > 0) %>%\n  \n# Filter 2 - ZA  ----\nfilter(str_length(seq) == ZA) %>%\n\n# Filter 3 - aligned length within specific parameters ----\nmutate(cigar_seq = as.character(sequenceLayer(DNAStringSet(seq), cigar))) %>%\nmutate(cigar_len = str_length(cigar_seq)) %>%\nfilter(cigar_len >= min_len & cigar_len <= max_len) %>%\n\n# Filter 4 - mapq is greater than specific parameters ----\nfilter(mapq >= min_mq)\n\n # filter 5 - barcode is perfect match ----\n\nbam_json_with_barcode = barcode_list %>%\nselect(bc2_id = id, bc_sequence = sequence, bc_adapter = adapter) %>%\nfilter(str_sub(bc2_id, end =1) == \"P\") %>%\nmutate(bc_length = str_length(bc_sequence)) %>%\ngroup_by(bc2_id, bc_sequence) %>%\ndo({\nbc_length = .$bc_length\nbc_sequence = .$bc_sequence\n\nbam_json_temp = bam_json %>%\nmutate(three_prime_seq = str_sub(seq, start = -(bc_length))) %>%\nfilter(three_prime_seq == bc_sequence)\n\n}) %>%\nungroup() %>%\nmutate(qualified_barcode_reads = n()) %>%\ngroup_by(file_name, bc1_id, bc2_id, HPV_Type) %>%\nmutate(HPV_Type_count = n()) %>%\nungroup()\n\n### lineage for 2017 ###\nlineage_output = bam_json_with_barcode %>%\nselect(bc1_id, bc2_id, qname, HPV_Type, mapq, cigar_seq, HPV_Type_count) %>%\ninner_join(lineage_reference_table, by = \"HPV_Type\") %>%\nmutate(lineage_tag = \"No value\") %>% \nmutate(lineage_tag = ifelse(str_sub(cigar_seq, Base_num, Base_num) == Base_ID,\n                            paste0(HPV_Type,\"_\", Lineage_ID), \"undetermined\")) %>%\ngroup_by(qname, HPV_Type, Lineage_ID) %>%\nmutate(lineage_tag = paste(lineage_tag, collapse = \",\")) %>%\nungroup() %>%\nselect(bc1_id, bc2_id,qname, HPV_Type, Lineage_ID, lineage_tag, cigar_seq, mapq, HPV_Type_count) %>%\ndistinct() %>%\nmutate(total_reads = n()) %>%\nmutate(lineage_tag = ifelse(str_detect(lineage_tag, \"undetermined\"), \"undetermined\", \"full match\")) %>%\ngroup_by(bc1_id, bc2_id, HPV_Type, Lineage_ID, lineage_tag) %>% \nmutate(lineage_read_count = n()) %>%\nungroup() %>%\nmutate(page_num = page) %>%\nselect(bc1_id, bc2_id, page_num, HPV_Type, Lineage_ID, lineage_tag, lineage_read_count, HPV_Type_count) %>%\ndistinct()\n####   \n  \n#### finish the bc2 demultiplex df ####\nhpv_types_output = bam_json_with_barcode %>%  \nselect(file_name, page_num, bc1_id, bc2_id, qualified_barcode_reads, HPV_Type, HPV_Type_count, display_order) %>%\ndistinct()\n  \n### make a list output ###\noutput = list(hpv_types_output = hpv_types_output, lineage_output = lineage_output)\n\n}\n\n# COMMAND ----------\n\nparameters_df = read_tsv(args_parameter_file$path) %>% \nmap_if(is.factor, as.character) %>% \nas_tibble() %>% \nmutate(min_mq = mq) %>% \nselect(-mq)\n\nlineage_reference_table = read_csv(args_lineage_reference_path) %>%\nmap_if(is.factor, as.character) %>% \nas_tibble() %>% \nglimpse()\n\nbarcode_list = read_csv(args_barcode_list)\npage = 1\n\n# COMMAND ----------\n\nread_metrics_output = file(paste0(args_bam_json$name,\"_read_metrics.json\"), open = \"wb\")\nbc2_demultiplex_output = file(paste0(args_bam_json$name,\"_bc2_demultiplex.json\"), open = \"wb\")\nlineage_output = file(paste0(args_bam_json$name,\"_hpv_lineage.json\"),open = \"wb\")\n\nstream_in(file(args_bam_json$path), handler = function(df){\n\nread_metrics_df = df %>% \nts_read_metrics(parameters_df)\n  \n\nbc2_demultiplex_df = df %>% \nts_demultiplex_bc2(parameters_df, barcode_list)\n\nstream_out(read_metrics_df, read_metrics_output, verbose = TRUE) \n  \nstream_out(bc2_demultiplex_df$hpv_types_output, bc2_demultiplex_output, verbose = TRUE) \n  \nstream_out(bc2_demultiplex_df$lineage_output, lineage_output, verbose = TRUE) \n  \npage <<- page + 1\n\n}, pagesize = 10000, verbose = FALSE)\n\nclose(read_metrics_output)\nclose(bc2_demultiplex_output)\nclose(lineage_output)",
                "filename": "ion_torrent_typing_read_processor.R"
              }
            ],
            "class": "CreateFileRequirement"
          }
        ],
        "sbg:modifiedOn": 1527697061,
        "x": 852.1156005859375,
        "sbg:publisher": "sbg",
        "cwlVersion": "sbg:draft-2",
        "sbg:image_url": null,
        "sbg:validationErrors": [],
        "y": 670.492431640625,
        "sbg:createdBy": "dave",
        "sbg:sbgMaintained": false
      },
      "outputs": [
        {
          "id": "#ion_torrent_typing_read_processor_1.read_metrics"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.hpv_types"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.hpv_lineage"
        }
      ]
    }
  ],
  "sbg:modifiedOn": 1531515884,
  "sbg:toolkitVersion": "",
  "description": "",
  "cwlVersion": "sbg:draft-2",
  "sbg:project": "dave/cgr-apps",
  "sbg:validationErrors": [],
  "label": "hpv typing ion workflow",
  "sbg:canvas_x": -402,
  "sbg:categories": [
    "hpv_typing"
  ],
  "sbg:canvas_zoom": 0.7999999999999998,
  "sbg:toolkit": "hpv_typing",
  "sbg:createdBy": "dave"
}
