{
  "$namespaces": {
    "sbg": "https://sevenbridges.com"
  },
  "sbg:revisionsInfo": [
    {
      "sbg:revisionNotes": "Copy of dave/rd111-typing-v2/ion-hpv-typeseqer/8",
      "sbg:revision": 0,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1526931208
    },
    {
      "sbg:revisionNotes": "moving to cgr apps folder",
      "sbg:revision": 1,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1526931776
    },
    {
      "sbg:revisionNotes": "exposed minimum lineage read count",
      "sbg:revision": 2,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1526932910
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 3,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1526933968
    },
    {
      "sbg:revisionNotes": "hpv_typing_report (Revision 1)  \"added conditional display\"",
      "sbg:revision": 4,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527090949
    },
    {
      "sbg:revisionNotes": "added temporarily bam json output for testing",
      "sbg:revision": 5,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527091933
    },
    {
      "sbg:revisionNotes": "hpv_typing_report \"fixing num types pos for grouped output\"",
      "sbg:revision": 6,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527192246
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 7,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527192677
    },
    {
      "sbg:revisionNotes": "added lineage code back in",
      "sbg:revision": 8,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527620139
    },
    {
      "sbg:revisionNotes": "added scatter to bam_json",
      "sbg:revision": 9,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527621216
    },
    {
      "sbg:revisionNotes": "read processor \"corrected lineage path args.R\"",
      "sbg:revision": 10,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527625427
    },
    {
      "sbg:revisionNotes": "processor - \"removed and args.R typo\"",
      "sbg:revision": 11,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527693072
    },
    {
      "sbg:revisionNotes": "added json splitter",
      "sbg:revision": 12,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527694469
    },
    {
      "sbg:revisionNotes": "removed json splitter",
      "sbg:revision": 13,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527696804
    },
    {
      "sbg:revisionNotes": "processor - \"correteing args.R issue\"",
      "sbg:revision": 14,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527697105
    },
    {
      "sbg:revisionNotes": "added lineage table output",
      "sbg:revision": 15,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527870673
    },
    {
      "sbg:revisionNotes": "report app - \"added lineage refernce table input\"",
      "sbg:revision": 16,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527871225
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 17,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527873571
    },
    {
      "sbg:revisionNotes": "fixing dag",
      "sbg:revision": 18,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527875212
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 19,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527875232
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 20,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527875261
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 21,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527875271
    },
    {
      "sbg:revisionNotes": "exposed pass through",
      "sbg:revision": 22,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527876630
    },
    {
      "sbg:revisionNotes": "",
      "sbg:revision": 23,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527876947
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 24,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527877327
    },
    {
      "sbg:revisionNotes": "exposed params",
      "sbg:revision": 25,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527877694
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 26,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1527877735
    },
    {
      "sbg:revisionNotes": "\"added safe lineage plot funciton\"",
      "sbg:revision": 27,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528136626
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 28,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528136847
    },
    {
      "sbg:revisionNotes": "\"removed last line of rscript syntax error\"",
      "sbg:revision": 29,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528139561
    },
    {
      "sbg:revisionNotes": "cgc fix",
      "sbg:revision": 30,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528139626
    },
    {
      "sbg:revisionNotes": "exposed is_torrent_server",
      "sbg:revision": 31,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528142036
    },
    {
      "sbg:revisionNotes": "exposed is_torrent_server",
      "sbg:revision": 32,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528142443
    },
    {
      "sbg:revisionNotes": "\"added is_tn\"",
      "sbg:revision": 33,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528168503
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 34,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528168600
    },
    {
      "sbg:revisionNotes": "dag stuff",
      "sbg:revision": 35,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528301212
    },
    {
      "sbg:revisionNotes": "docs",
      "sbg:revision": 36,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528914156
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 37,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1528914196
    },
    {
      "sbg:revisionNotes": "fixed get args in report",
      "sbg:revision": 38,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529007013
    },
    {
      "sbg:revisionNotes": "fixed get args",
      "sbg:revision": 39,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529007096
    },
    {
      "sbg:revisionNotes": "corrected args.R",
      "sbg:revision": 40,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529009499
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 41,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529009758
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 42,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529010040
    },
    {
      "sbg:revisionNotes": "\"better lineage matrix and plots\"",
      "sbg:revision": 43,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529264599
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 44,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1529264691
    },
    {
      "sbg:revisionNotes": "\"switched to TypeSeqer package\"",
      "sbg:revision": 45,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530021378
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 46,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530021871
    },
    {
      "sbg:revisionNotes": "corrected final_pn_matrix cp cmd",
      "sbg:revision": 47,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530026561
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 48,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530026618
    },
    {
      "sbg:revisionNotes": "put cp back in for ts",
      "sbg:revision": 49,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530037446
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 50,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530037482
    },
    {
      "sbg:revisionNotes": "removed links from tn html block",
      "sbg:revision": 51,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530046778
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 52,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530046927
    },
    {
      "sbg:revisionNotes": "corrected html page for thumbnail",
      "sbg:revision": 53,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530099923
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 54,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1530101389
    },
    {
      "sbg:revisionNotes": "hpv_typing_report (Revision 19)  \"updated R package name\"",
      "sbg:revision": 55,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531490670
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 56,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531490811
    },
    {
      "sbg:revisionNotes": "fixing TypeSeqHPV R package name",
      "sbg:revision": 57,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531494365
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 58,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531494417
    },
    {
      "sbg:revisionNotes": "final_2018071301",
      "sbg:revision": 59,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531515803
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 60,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1531515884
    },
    {
      "sbg:revisionNotes": "html block now in TypeSeq pakcage",
      "sbg:revision": 61,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532375241
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 62,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532375291
    },
    {
      "sbg:revisionNotes": "2018072301 docker tag for report app",
      "sbg:revision": 63,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532394378
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 64,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532394468
    },
    {
      "sbg:revisionNotes": "\"added a require TypeSeqHPV\"",
      "sbg:revision": 65,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532532188
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 66,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532532232
    },
    {
      "sbg:revisionNotes": "\"added another require TypeSeqHPV\"",
      "sbg:revision": 67,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532541846
    },
    {
      "sbg:revisionNotes": null,
      "sbg:revision": 68,
      "sbg:modifiedBy": "dave",
      "sbg:modifiedOn": 1532541890
    }
  ],
  "inputs": [
    {
      "id": "#parameter_file",
      "sbg:x": 154.1618194580078,
      "type": [
        "null",
        "File"
      ],
      "sbg:y": 851.0724487304688,
      "label": "parameter_file"
    },
    {
      "id": "#lineage_reference_table",
      "sbg:x": 53.055274963378906,
      "type": [
        "null",
        "File"
      ],
      "sbg:y": 982.7135620117188,
      "label": "lineage_reference_table"
    },
    {
      "id": "#input",
      "sbg:x": 63.477474212646484,
      "label": "bam",
      "sbg:fileTypes": "BAM, SAM",
      "sbg:y": -22.762008666992188,
      "sbg:includeInPorts": true,
      "secondaryFiles": [
        ".bai"
      ],
      "type": [
        {
          "items": "File",
          "type": "array"
        }
      ]
    },
    {
      "id": "#run_manifest",
      "sbg:x": -38.45930480957031,
      "type": [
        "null",
        "File"
      ],
      "sbg:y": 174.097900390625,
      "label": "run_manifest"
    },
    {
      "id": "#barcode_list",
      "sbg:x": 232.76622009277344,
      "type": [
        "null",
        "File"
      ],
      "sbg:y": 1024.540283203125,
      "label": "barcode_list"
    },
    {
      "id": "#control_definitions",
      "sbg:x": -81.65652465820312,
      "sbg:y": 303.99859619140625,
      "type": [
        "null",
        "File"
      ],
      "sbg:includeInPorts": true,
      "label": "control_definitions"
    },
    {
      "id": "#report_grouping",
      "sbg:x": -26.0455265045166,
      "sbg:y": 63.10072326660156,
      "type": [
        "null",
        "File"
      ],
      "sbg:includeInPorts": true,
      "label": "report_grouping"
    },
    {
      "id": "#scaling_table",
      "sbg:x": 367.56280517578125,
      "sbg:y": 1086.0753173828125,
      "type": [
        "null",
        "File"
      ],
      "sbg:includeInPorts": true,
      "sbg:fileTypes": "CSV",
      "label": "#scaling_table"
    },
    {
      "id": "#pos_neg_filtering_criteria_path",
      "sbg:x": 10.055275917053223,
      "sbg:y": 751.422119140625,
      "type": [
        "null",
        "File"
      ],
      "sbg:includeInPorts": true,
      "label": "#pos_neg_filtering_criteria_path"
    },
    {
      "id": "#manifest_json_parse_passthrough",
      "type": [
        "null",
        "boolean"
      ]
    },
    {
      "id": "#control_def_json_parse_passthrough",
      "type": [
        "null",
        "boolean"
      ]
    },
    {
      "id": "#report_grouping_json_parse_passthrough",
      "type": [
        "null",
        "boolean"
      ]
    },
    {
      "sbg:category": "Execution",
      "id": "#mem_mb",
      "sbg:toolDefaultValue": "1024",
      "description": "Memory in MB.",
      "sbg:suggestedValue": 8000,
      "label": "Memory in MB",
      "sbg:stageInput": null,
      "type": [
        "null",
        "int"
      ]
    },
    {
      "id": "#is_torrent_server",
      "type": [
        "null",
        "boolean"
      ]
    }
  ],
  "steps": [
    {
      "id": "#select_first_file_in_array",
      "sbg:x": 532.7239379882812,
      "inputs": [
        {
          "id": "#select_first_file_in_array.files",
          "source": [
            "#input"
          ]
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of dave/cgrhpv/cat-json/4",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1492711798
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1492712033
          },
          {
            "sbg:revisionNotes": "renamed output",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1492712213
          }
        ],
        "inputs": [
          {
            "id": "#files",
            "required": false,
            "sbg:stageInput": "link",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          }
        ],
        "baseCommand": [
          "ls",
          "-lhrt"
        ],
        "sbg:createdOn": 1492711798,
        "sbg:latestRevision": 2,
        "sbg:job": {
          "inputs": {
            "files": [
              {
                "path": "path/to/IonXpress_075.bam",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              },
              {
                "path": "path/to/IonXpress_076.split.bam",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              }
            ]
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 532.7239379882812,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 2,
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "$job.inputs.files[1].path",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#files"
            },
            "id": "#first_file",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:id": "dave/cgrhpv/select-first-file-in-array/2",
        "class": "CommandLineTool",
        "y": 20.915002822875977,
        "sbg:validationErrors": [],
        "sbg:revisionNotes": "renamed output",
        "id": "dave/cgrhpv/select-first-file-in-array/2",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "ls -lhrt",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse",
            "class": "DockerRequirement"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1492712213,
        "label": "select first file in array"
      },
      "outputs": [
        {
          "id": "#select_first_file_in_array.first_file"
        }
      ],
      "sbg:y": 20.915002822875977
    },
    {
      "id": "#plugin_manifest_parse",
      "sbg:x": 240.45729064941406,
      "inputs": [
        {
          "id": "#plugin_manifest_parse.startplugin_json",
          "source": "#run_manifest"
        },
        {
          "default": false,
          "id": "#plugin_manifest_parse.manifest_json_parse_passthrough",
          "source": [
            "#manifest_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1500589561
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1500589858
          },
          {
            "sbg:revisionNotes": "corrected args",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1500603095
          },
          {
            "sbg:revisionNotes": "fixing glob",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1500612528
          },
          {
            "sbg:revisionNotes": "added passthrough parameter for manifest parse",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1507135221
          },
          {
            "sbg:revisionNotes": "removed selecting only first 8 columns",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 5,
            "sbg:modifiedOn": 1509470599
          },
          {
            "sbg:revisionNotes": "new parse method",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 6,
            "sbg:modifiedOn": 1509810752
          },
          {
            "sbg:revisionNotes": "renamed passthrough",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 7,
            "sbg:modifiedOn": 1509810857
          },
          {
            "sbg:revisionNotes": "updated base command",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 8,
            "sbg:modifiedOn": 1509813246
          },
          {
            "sbg:revisionNotes": "added stringr",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 9,
            "sbg:modifiedOn": 1509814378
          }
        ],
        "inputs": [
          {
            "id": "#startplugin_json",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#manifest_json_parse_passthrough",
            "type": [
              "null",
              "boolean"
            ]
          }
        ],
        "baseCommand": [
          {
            "script": "if($job.inputs.manifest_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./typing_manifest.csv\"}else{\"Rscript plugin_manfiest_parse.R\"} ",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1500589561,
        "sbg:latestRevision": 9,
        "sbg:job": {
          "inputs": {
            "startplugin_json": {
              "path": "/path/to/startplugin.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "manifest_json_parse_passthrough": true
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 240.45729064941406,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 9,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": "typing_manifest.csv"
            },
            "id": "#manifest_csv",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:validationErrors": [],
        "class": "CommandLineTool",
        "y": 447.8442077636719,
        "sbg:id": "dave/cgrhpv/plugin-manifest-parse/9",
        "sbg:revisionNotes": "added stringr",
        "id": "dave/cgrhpv/plugin-manifest-parse/9",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "cp /path/to/startplugin.json ./typing_manifest.csv",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse:latest",
            "class": "DockerRequirement"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          },
          {
            "class": "CreateFileRequirement",
            "fileDef": [
              {
                "filename": "args.R",
                "fileContent": {
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression",
                  "engine": "#cwl-js-engine"
                }
              },
              {
                "filename": "plugin_manfiest_parse.R",
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$typing_manifest) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"typing_manifest.csv\")\n\n# COMMAND ----------"
              }
            ]
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1509814378,
        "label": "plugin_manifest_parse"
      },
      "outputs": [
        {
          "id": "#plugin_manifest_parse.manifest_csv"
        }
      ],
      "sbg:y": 447.8442077636719
    },
    {
      "id": "#plugin_control_defs_parse",
      "sbg:x": 205.0703582763672,
      "inputs": [
        {
          "id": "#plugin_control_defs_parse.startplugin_json",
          "source": "#control_definitions"
        },
        {
          "default": false,
          "id": "#plugin_control_defs_parse.control_def_json_parse_passthrough",
          "source": [
            "#control_def_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of dave/cgrhpv/plugin-manifest-parse/7",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1509812523
          },
          {
            "sbg:revisionNotes": "updated",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1509812900
          },
          {
            "sbg:revisionNotes": "updated glob",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1509813156
          },
          {
            "sbg:revisionNotes": "added stringr",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1509814403
          },
          {
            "sbg:revisionNotes": "corrected base command",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1509815990
          }
        ],
        "inputs": [
          {
            "id": "#startplugin_json",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#control_def_json_parse_passthrough",
            "type": [
              "null",
              "boolean"
            ]
          }
        ],
        "baseCommand": [
          {
            "script": "if($job.inputs.control_def_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./control_defs.csv\"}else{\"Rscript plugin_control_defs_parse.R\"} ",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1509812523,
        "sbg:latestRevision": 4,
        "sbg:job": {
          "inputs": {
            "startplugin_json": {
              "path": "/path/to/startplugin.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "control_def_json_parse_passthrough": true
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 205.0703582763672,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 4,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": "control_defs.csv",
              "sbg:inheritMetadataFrom": "#startplugin_json"
            },
            "id": "#control_defs",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:validationErrors": [],
        "class": "CommandLineTool",
        "y": 566.2462158203125,
        "sbg:id": "dave/cgrhpv/plugin-control-defs-parse/4",
        "sbg:revisionNotes": "corrected base command",
        "id": "dave/cgrhpv/plugin-control-defs-parse/4",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "cp /path/to/startplugin.json ./control_defs.csv",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse:latest",
            "class": "DockerRequirement"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          },
          {
            "class": "CreateFileRequirement",
            "fileDef": [
              {
                "filename": "args.R",
                "fileContent": {
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression",
                  "engine": "#cwl-js-engine"
                }
              },
              {
                "filename": "plugin_control_defs_parse.R",
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$control_definitions) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"control_defs.csv\")"
              }
            ]
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1509815990,
        "label": "plugin_control-defs-parse"
      },
      "outputs": [
        {
          "id": "#plugin_control_defs_parse.control_defs"
        }
      ],
      "sbg:y": 566.2462158203125
    },
    {
      "id": "#plugin_report_grouping_parse",
      "sbg:x": 249.80401611328125,
      "inputs": [
        {
          "id": "#plugin_report_grouping_parse.startplugin_json",
          "source": "#report_grouping"
        },
        {
          "default": false,
          "id": "#plugin_report_grouping_parse.report_grouping_json_parse_passthrough",
          "source": [
            "#report_grouping_json_parse_passthrough"
          ]
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of dave/cgrhpv/plugin-control-defs-parse/4",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1509820752
          },
          {
            "sbg:revisionNotes": "updated codes",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1509821106
          },
          {
            "sbg:revisionNotes": "updated R code",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1509821235
          },
          {
            "sbg:revisionNotes": "updated name",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1509821257
          },
          {
            "sbg:revisionNotes": "corrected command line",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1509823186
          }
        ],
        "inputs": [
          {
            "id": "#startplugin_json",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#report_grouping_json_parse_passthrough",
            "type": [
              "null",
              "boolean"
            ]
          }
        ],
        "baseCommand": [
          {
            "script": "if($job.inputs.report_grouping_json_parse_passthrough){\"cp \" + $job.inputs.startplugin_json.path + \" ./report_grouping.csv\"}else{\"Rscript plugin_report_grouping_parse.R\"} ",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1509820752,
        "sbg:latestRevision": 4,
        "sbg:job": {
          "inputs": {
            "startplugin_json": {
              "path": "/path/to/startplugin.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "report_grouping_json_parse_passthrough": false
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 249.80401611328125,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 4,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": "report_grouping.csv",
              "sbg:inheritMetadataFrom": "#startplugin_json"
            },
            "id": "#report_grouping",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:validationErrors": [],
        "class": "CommandLineTool",
        "y": 318.4773864746094,
        "sbg:id": "dave/cgrhpv/plugin-report-grouping-parse/4",
        "sbg:revisionNotes": "corrected command line",
        "id": "dave/cgrhpv/plugin-report-grouping-parse/4",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "Rscript plugin_report_grouping_parse.R",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse:latest",
            "class": "DockerRequirement"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          },
          {
            "class": "CreateFileRequirement",
            "fileDef": [
              {
                "filename": "args.R",
                "fileContent": {
                  "script": "'# get args \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\"'",
                  "class": "Expression",
                  "engine": "#cwl-js-engine"
                }
              },
              {
                "filename": "plugin_report_grouping_parse.R",
                "fileContent": "require(jsonlite)\nrequire(tidyverse)\nrequire(stringr)\n\nsource(\"args.R\")\n\nplugin_json = fromJSON(args_start_plugin_path, simplifyDataFrame = TRUE, simplifyMatrix = TRUE)\n\nmanifest = data_frame(values = plugin_json$pluginconfig$report_grouping_definitions) %>%\nmutate(values = str_replace(values, \"\\n\", \"\" )) %>%\nseparate(col=values, sep=\",\", into = unlist(str_split(.$values[1], \",\"))) %>%\nslice(2:n()) %>%\nwrite_csv(\"report_grouping.csv\")"
              }
            ]
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1509823186,
        "label": "plugin_report_grouping_parse"
      },
      "outputs": [
        {
          "id": "#plugin_report_grouping_parse.report_grouping"
        }
      ],
      "sbg:y": 318.4773864746094
    },
    {
      "id": "#merge_read_metrics",
      "sbg:x": 984.531005859375,
      "inputs": [
        {
          "default": "read_metrics",
          "id": "#merge_read_metrics.prefix_for_output"
        },
        {
          "id": "#merge_read_metrics.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.read_metrics"
          ]
        },
        {
          "default": "read_metrics.json",
          "id": "#merge_read_metrics.input_suffix_and_extension"
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1486841449
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1486841686
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1486841826
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1486858801
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1486874369
          },
          {
            "sbg:revisionNotes": "made a better cat app",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 5,
            "sbg:modifiedOn": 1494294732
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 6,
            "sbg:modifiedOn": 1495472946
          },
          {
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 7,
            "sbg:modifiedOn": 1505248169
          },
          {
            "sbg:revisionNotes": "added prefix input",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 8,
            "sbg:modifiedOn": 1505248365
          }
        ],
        "inputs": [
          {
            "id": "#prefix_for_output",
            "type": [
              "null",
              "string"
            ]
          },
          {
            "id": "#json",
            "required": false,
            "sbg:stageInput": "link",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "id": "#input_suffix_and_extension",
            "type": [
              "null",
              "string"
            ]
          }
        ],
        "baseCommand": [
          "cat",
          {
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1486841449,
        "sbg:latestRevision": 8,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "path": "path/to/sample01.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              },
              {
                "path": "path/to/sample02.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 984.531005859375,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 8,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "\"*merged.json\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#json"
            },
            "id": "#merged_json",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "class": "CommandLineTool",
        "y": 514.8192749023438,
        "sbg:validationErrors": [],
        "sbg:revisionNotes": "added prefix input",
        "id": "dave/cgrhpv/cat-json/8",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse",
            "class": "DockerRequirement"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "prefix": ">",
            "position": 99,
            "valueFrom": {
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1505248365,
        "label": "merge read metrics"
      },
      "outputs": [
        {
          "id": "#merge_read_metrics.merged_json"
        }
      ],
      "sbg:y": 514.8192749023438
    },
    {
      "id": "#merge_HPV_types",
      "sbg:x": 1048.531005859375,
      "inputs": [
        {
          "default": "bc2_demultiplex",
          "id": "#merge_HPV_types.prefix_for_output"
        },
        {
          "id": "#merge_HPV_types.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.hpv_types"
          ]
        },
        {
          "default": "bc2_demultiplex.json",
          "id": "#merge_HPV_types.input_suffix_and_extension"
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1486841449
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1486841686
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1486841826
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1486858801
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1486874369
          },
          {
            "sbg:revisionNotes": "made a better cat app",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 5,
            "sbg:modifiedOn": 1494294732
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 6,
            "sbg:modifiedOn": 1495472946
          },
          {
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 7,
            "sbg:modifiedOn": 1505248169
          },
          {
            "sbg:revisionNotes": "added prefix input",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 8,
            "sbg:modifiedOn": 1505248365
          }
        ],
        "inputs": [
          {
            "id": "#prefix_for_output",
            "type": [
              "null",
              "string"
            ]
          },
          {
            "id": "#json",
            "required": false,
            "sbg:stageInput": "link",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "id": "#input_suffix_and_extension",
            "type": [
              "null",
              "string"
            ]
          }
        ],
        "baseCommand": [
          "cat",
          {
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1486841449,
        "sbg:latestRevision": 8,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "path": "path/to/sample01.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              },
              {
                "path": "path/to/sample02.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 1048.531005859375,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 8,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "\"*merged.json\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#json"
            },
            "id": "#merged_json",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "class": "CommandLineTool",
        "y": 628.7393798828125,
        "sbg:validationErrors": [],
        "sbg:revisionNotes": "added prefix input",
        "id": "dave/cgrhpv/cat-json/8",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse",
            "class": "DockerRequirement"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "prefix": ">",
            "position": 99,
            "valueFrom": {
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1505248365,
        "label": "merge HPV types"
      },
      "outputs": [
        {
          "id": "#merge_HPV_types.merged_json"
        }
      ],
      "sbg:y": 628.7393798828125
    },
    {
      "id": "#merge_lineage",
      "sbg:x": 1131.457763671875,
      "inputs": [
        {
          "default": "lineage",
          "id": "#merge_lineage.prefix_for_output"
        },
        {
          "id": "#merge_lineage.json",
          "source": [
            "#ion_torrent_typing_read_processor_1.hpv_lineage"
          ]
        },
        {
          "default": "hpv_lineage.json",
          "id": "#merge_lineage.input_suffix_and_extension"
        }
      ],
      "run": {
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1486841449
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1486841686
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1486841826
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1486858801
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1486874369
          },
          {
            "sbg:revisionNotes": "made a better cat app",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 5,
            "sbg:modifiedOn": 1494294732
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 6,
            "sbg:modifiedOn": 1495472946
          },
          {
            "sbg:revisionNotes": "switched to wildcard",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 7,
            "sbg:modifiedOn": 1505248169
          },
          {
            "sbg:revisionNotes": "added prefix input",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 8,
            "sbg:modifiedOn": 1505248365
          }
        ],
        "inputs": [
          {
            "id": "#prefix_for_output",
            "type": [
              "null",
              "string"
            ]
          },
          {
            "id": "#json",
            "required": false,
            "sbg:stageInput": "link",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "id": "#input_suffix_and_extension",
            "type": [
              "null",
              "string"
            ]
          }
        ],
        "baseCommand": [
          "cat",
          {
            "script": "'*' + $job.inputs.input_suffix_and_extension",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          }
        ],
        "sbg:createdOn": 1486841449,
        "sbg:latestRevision": 8,
        "sbg:job": {
          "inputs": {
            "input_suffix_and_extension": "concat.json",
            "json": [
              {
                "path": "path/to/sample01.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              },
              {
                "path": "path/to/sample02.json",
                "class": "File",
                "size": 0,
                "secondaryFiles": []
              }
            ],
            "prefix_for_output": "HPV_all_vcf"
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 1131.457763671875,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 8,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "\"*merged.json\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#json"
            },
            "id": "#merged_json",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:id": "dave/cgrhpv/cat-json/8",
        "class": "CommandLineTool",
        "y": 713.4400024414062,
        "sbg:validationErrors": [],
        "sbg:revisionNotes": "added prefix input",
        "id": "dave/cgrhpv/cat-json/8",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "cat *concat.json > HPV_all_vcf_merged.json",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/tidyverse",
            "class": "DockerRequirement"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "prefix": ">",
            "position": 99,
            "valueFrom": {
              "script": "$job.inputs.prefix_for_output + \"_merged.json\"",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1505248365,
        "label": "merge lineage"
      },
      "outputs": [
        {
          "id": "#merge_lineage.merged_json"
        }
      ],
      "sbg:y": 713.4400024414062
    },
    {
      "id": "#Sambamba_View",
      "sbg:x": 682.8693237304688,
      "inputs": [
        {
          "id": "#Sambamba_View.with_header"
        },
        {
          "id": "#Sambamba_View.valid"
        },
        {
          "id": "#Sambamba_View.subsampling_seed"
        },
        {
          "id": "#Sambamba_View.subsample"
        },
        {
          "id": "#Sambamba_View.sam_input"
        },
        {
          "id": "#Sambamba_View.reserved_threads"
        },
        {
          "id": "#Sambamba_View.regions"
        },
        {
          "id": "#Sambamba_View.ref_filename"
        },
        {
          "default": "json",
          "id": "#Sambamba_View.output"
        },
        {
          "id": "#Sambamba_View.nthreads"
        },
        {
          "id": "#Sambamba_View.mem_mb",
          "source": [
            "#mem_mb"
          ]
        },
        {
          "id": "#Sambamba_View.input",
          "source": "#input"
        },
        {
          "id": "#Sambamba_View.filter"
        },
        {
          "id": "#Sambamba_View.cram_input"
        },
        {
          "id": "#Sambamba_View.count"
        },
        {
          "id": "#Sambamba_View.compression_level"
        }
      ],
      "scatter": "#Sambamba_View.input",
      "run": {
        "sbg:license": "GNU General Public License v2.0 only",
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of dave/cgrwgs/sambamba-view-0-5-9/1",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1485478878
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1486834921
          },
          {
            "sbg:revisionNotes": "corrected command line and switch to typeseqer docker",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1520743858
          }
        ],
        "inputs": [
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--with-header"
            },
            "id": "#with_header",
            "description": "Print header before reads (always done for BAM output).",
            "label": "With header",
            "sbg:altPrefix": "h",
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "sbg:category": "Execution",
            "description": "Output only valid reads.",
            "type": [
              "null",
              "boolean"
            ],
            "id": "#valid",
            "label": "Valid"
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--subsampling-seed"
            },
            "id": "#subsampling_seed",
            "description": "Set seed for subsampling.",
            "label": "Subsampling seed",
            "type": [
              "null",
              "int"
            ]
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--subsample="
            },
            "id": "#subsample",
            "description": "Subsample reads (read pairs).",
            "type": [
              "null",
              "float"
            ],
            "sbg:altPrefix": "s",
            "sbg:stageInput": null,
            "label": "Subsample"
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--sam-input"
            },
            "id": "#sam_input",
            "description": "Specify that input is in SAM format.",
            "label": "SAM input",
            "sbg:altPrefix": "S",
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "sbg:category": "Execution",
            "id": "#reserved_threads",
            "sbg:toolDefaultValue": "1",
            "description": "Number of threads reserved on the instance passed to the scheduler (number of jobs).",
            "label": "Number of threads reserved on the instance",
            "sbg:stageInput": null,
            "type": [
              "null",
              "int"
            ]
          },
          {
            "sbg:category": "File input.",
            "inputBinding": {
              "separate": false,
              "position": 0,
              "sbg:cmdInclude": true,
              "secondaryFiles": [],
              "prefix": "--regions="
            },
            "required": false,
            "id": "#regions",
            "description": "Output only reads overlapping one of regions from the BED file.",
            "type": [
              "null",
              "File"
            ],
            "sbg:altPrefix": "L",
            "sbg:fileTypes": "BED",
            "label": "Regions"
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": false,
              "position": 0,
              "sbg:cmdInclude": true,
              "secondaryFiles": [],
              "prefix": "--ref-filename="
            },
            "required": false,
            "id": "#ref_filename",
            "description": "Specify reference for writing CRAM.",
            "type": [
              "null",
              "File"
            ],
            "sbg:altPrefix": "T",
            "sbg:fileTypes": "FASTA, FA",
            "label": "Reference"
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": false,
              "position": 1,
              "sbg:cmdInclude": true,
              "prefix": "--format="
            },
            "id": "#output",
            "description": "Specify which format to use for output (default is SAM).",
            "label": "Output format",
            "sbg:altPrefix": "-f",
            "type": [
              {
                "name": "output",
                "symbols": [
                  "sam",
                  "bam",
                  "cram",
                  "json"
                ],
                "type": "enum"
              }
            ]
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": false,
              "prefix": "--nthreads=",
              "position": 0,
              "sbg:cmdInclude": true,
              "valueFrom": {
                "script": "{\n  if ($job.inputs.nthreads)\n    return $job.inputs.nthreads\n  else\n    return 8\n}",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              }
            },
            "sbg:toolDefaultValue": "8",
            "id": "#nthreads",
            "description": "Number of threads to use.",
            "type": [
              "null",
              "int"
            ],
            "sbg:altPrefix": "-t",
            "label": "Number of threads"
          },
          {
            "sbg:category": "Execution",
            "id": "#mem_mb",
            "sbg:toolDefaultValue": "1024",
            "description": "Memory in MB.",
            "label": "Memory in MB",
            "sbg:stageInput": null,
            "type": [
              "null",
              "int"
            ]
          },
          {
            "sbg:category": "Inputs",
            "inputBinding": {
              "separate": true,
              "position": 2,
              "sbg:cmdInclude": true,
              "secondaryFiles": [
                ".bai"
              ],
              "itemSeparator": " "
            },
            "required": true,
            "id": "#input",
            "description": "BAM or SAM file.",
            "label": "Input",
            "sbg:fileTypes": "BAM, SAM",
            "type": [
              "File"
            ]
          },
          {
            "sbg:category": "Basic Options",
            "inputBinding": {
              "itemSeparator": " ",
              "sbg:cmdInclude": true,
              "valueFrom": {
                "script": "{\n  if ($job.inputs.filter)\n  {\n  \treturn '\"'.concat($job.inputs.filter, '\"')\n  }\n}",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "prefix": "--filter",
              "position": 0,
              "separate": true
            },
            "id": "#filter",
            "description": "Set custom filter for alignments.",
            "label": "Filter",
            "sbg:altPrefix": "-F",
            "type": [
              "null",
              "string"
            ]
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--cram-input"
            },
            "id": "#cram_input",
            "description": "Specify that input is in CRAM format.",
            "label": "CRAM input",
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--count"
            },
            "id": "#count",
            "description": "Output to stdout only count of matching records, hHI are ignored.",
            "label": "Count",
            "sbg:altPrefix": "c",
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "sbg:category": "Execution",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "prefix": "--compression-level"
            },
            "id": "#compression_level",
            "description": "Specify compression level (from 0 to 9, works only for BAM output).",
            "label": "Compression level",
            "sbg:altPrefix": "l",
            "type": [
              "null",
              "int"
            ]
          }
        ],
        "baseCommand": [
          "/sambamba_v0.6.6",
          "view"
        ],
        "description": "Sambamba View efficiently filters a BAM file for alignments satisfying various conditions. It also accesses its SAM header and information about reference sequences. A JSON output is provided to make this data readily available for use with Perl, Python, and Ruby scripts.\n\nBy default, the tool expects a BAM file as an input. In order to work with a SAM file as an input, specify --sam-input command-line option. The tool does NOT automatically detect file format from its extension. Beware that when reading SAM, the tool will skip tags which don't conform to the SAM/BAM specification and set invalid fields to their default values. However, only syntax is checked, use --valid for full validation.",
        "sbg:categories": [
          "SAM/BAM-Processing"
        ],
        "sbg:createdOn": 1485478878,
        "sbg:latestRevision": 2,
        "sbg:job": {
          "inputs": {
            "output": "bam",
            "input": {
              "path": "/root/dir/example.bam",
              "secondaryFiles": [
                {
                  "path": ".bai"
                }
              ]
            },
            "subsample": 9.236016917973757,
            "mem_mb": 7,
            "filter": "unmapped",
            "nthreads": null,
            "reserved_threads": 8
          },
          "allocatedResources": {
            "mem": 7,
            "cpu": 8
          }
        },
        "sbg:sbgMaintained": false,
        "x": 682.8693237304688,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:validationErrors": [],
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "{\n  fnameRegex = /^(.*?)(?:\\.([^.]+))?$/;\n  file_path = $job.inputs.input.path;\n  base_name = fnameRegex.exec(file_path)[1];\n  file_name = base_name.replace(/^.*[\\\\\\/]/, '');\n  \n  if ($job.inputs.output == 'sam'){\n  \treturn file_name + '.filtered.sam'\n  }\n  else if ($job.inputs.output == 'bam'){\n  \treturn file_name.concat('.filtered.bam')\n  }\n  else if ($job.inputs.output == 'json'){\n  \treturn file_name.concat('.filtered.json')\n  }\n  else if ($job.inputs.output == 'msgpack'){\n  \treturn file_name.concat('.filtered.msgpack')\n  }\n  else\t{\n  \treturn file_name + '.filtered.sam'\n  }\n}",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#input"
            },
            "id": "#filtered",
            "description": "Bam file.",
            "label": "BAM file",
            "sbg:fileTypes": "BAM, SAM, JSON, MSGPACK",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:revision": 2,
        "class": "CommandLineTool",
        "sbg:toolAuthor": "Artem Tarasov",
        "sbg:links": [
          {
            "id": "http://lomereiter.github.io/sambamba/docs/sambamba-view.html",
            "label": "Homepage"
          },
          {
            "id": "https://github.com/lomereiter/sambamba",
            "label": "Source code"
          },
          {
            "id": "https://github.com/lomereiter/sambamba/wiki",
            "label": "Wiki"
          },
          {
            "id": "https://github.com/lomereiter/sambamba/releases/tag/v0.5.9",
            "label": "Download"
          },
          {
            "id": "http://lomereiter.github.io/sambamba/docs/sambamba-view.html",
            "label": "Publication"
          }
        ],
        "y": 790.9749145507812,
        "sbg:id": "dave/cgrhpv/sambamba-view-0-5-9/2",
        "sbg:toolkit": "Sambamba",
        "sbg:revisionNotes": "corrected command line and switch to typeseqer docker",
        "id": "dave/cgrhpv/sambamba-view-0-5-9/2",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "/sambamba_v0.6.6 view --format=bam  /root/dir/example.bam -o example.filtered.bam",
        "sbg:toolkitVersion": "0.5.9",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": {
              "script": "{\n  if ($job.inputs.reserved_threads) {\n    \n    return $job.inputs.reserved_threads\n    \n  } else if ($job.inputs.nthreads) {\n    \n    return $job.inputs.nthreads\n    \n  } else {\n    \n    return 1\n  }\n  \n}",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          },
          {
            "class": "sbg:MemRequirement",
            "value": {
              "script": "{\n  if ($job.inputs.mem_mb) {\n    \n    return $job.inputs.mem_mb\n    \n  } else {\n    \n    return 1024\n    \n  }\n  \n}",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          },
          {
            "class": "DockerRequirement",
            "dockerImageId": "59e577b13d5d",
            "dockerPull": "cgrlab/typeseqer:latest"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "prefix": "-o",
            "position": 3,
            "valueFrom": {
              "script": "{\n  fnameRegex = /^(.*?)(?:\\.([^.]+))?$/;\n  if ($job.inputs.input) \n  {\n  \tfile_path = $job.inputs.input.path;\n  \tbase_name = fnameRegex.exec(file_path)[1];\n  \tfile_name = base_name.replace(/^.*[\\\\\\/]/, '');\n  \n  if ($job.inputs.output == 'sam'){\n  \treturn file_name + '.filtered.sam'\n  }\n  else if ($job.inputs.output == 'bam'){\n  \treturn file_name.concat('.filtered.bam')\n  }\n  else if ($job.inputs.output == 'json'){\n  \treturn file_name.concat('.filtered.json')\n  }\n  else if ($job.inputs.output == 'msgpack'){\n  \treturn file_name.concat('.filtered.msgpack')\n  }\n  else\t{\n  \treturn file_name + '.filtered.sam'\n  }\n  }\n}",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1520743858,
        "label": "Sambamba View"
      },
      "outputs": [
        {
          "id": "#Sambamba_View.filtered"
        }
      ],
      "sbg:y": 790.9749145507812
    },
    {
      "id": "#SAMtools_extract_SAM_BAM_header",
      "sbg:x": 706.9485473632812,
      "inputs": [
        {
          "id": "#SAMtools_extract_SAM_BAM_header.input_bam_or_sam_file",
          "source": "#select_first_file_in_array.first_file"
        }
      ],
      "run": {
        "sbg:license": "BSD License, MIT License",
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of admin/sbg-public-data/samtools-extract-bam-header-1-3/9",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1492714234
          },
          {
            "sbg:revisionNotes": "no changes...just want to save a non-copy version in this project",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1492714376
          },
          {
            "sbg:revisionNotes": "removed aws instance hint",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1495125186
          },
          {
            "sbg:revisionNotes": "cgrlab/typeseqer:latest",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1520717721
          }
        ],
        "inputs": [
          {
            "sbg:category": "File input",
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "secondaryFiles": []
            },
            "required": true,
            "id": "#input_bam_or_sam_file",
            "description": "BAM or SAM input file.",
            "label": "BAM or SAM input file",
            "sbg:fileTypes": "BAM, SAM",
            "type": [
              "File"
            ]
          }
        ],
        "baseCommand": [
          "samtools",
          "view"
        ],
        "description": "Extract the header from the alignment file in SAM or BAM formats.",
        "sbg:categories": [
          "SAM/BAM-Processing"
        ],
        "sbg:createdOn": 1492714234,
        "sbg:latestRevision": 3,
        "sbg:job": {
          "inputs": {
            "input_bam_or_sam_file": {
              "path": "input_bam_or_sam_file.bam",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            }
          },
          "allocatedResources": {
            "mem": 1000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 706.9485473632812,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "cgrHPV",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:validationErrors": [],
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": "*.txt",
              "sbg:inheritMetadataFrom": "#input_bam_or_sam_file"
            },
            "id": "#output_header_file",
            "description": "Output header.",
            "label": "Output header",
            "sbg:fileTypes": "TXT",
            "type": [
              "File"
            ]
          }
        ],
        "sbg:revision": 3,
        "class": "CommandLineTool",
        "sbg:toolAuthor": "Heng Li/Sanger Institute,  Bob Handsaker/Broad Institute, James Bonfield/Sanger Institute,",
        "sbg:links": [
          {
            "id": "http://www.htslib.org",
            "label": "Homepage"
          },
          {
            "id": "https://github.com/samtools/",
            "label": "Source Code"
          },
          {
            "id": "https://sourceforge.net/projects/samtools/files/samtools/",
            "label": "Download"
          },
          {
            "id": "http://www.ncbi.nlm.nih.gov/pubmed/19505943",
            "label": "Publication"
          },
          {
            "id": "http://www.htslib.org/doc/samtools.html",
            "label": "Documentation"
          },
          {
            "id": "http://www.htslib.org",
            "label": "Wiki"
          }
        ],
        "y": 48.294185638427734,
        "sbg:id": "dave/cgrhpv/samtools-extract-bam-header-1-3/3",
        "sbg:toolkit": "SAMtools",
        "sbg:revisionNotes": "cgrlab/typeseqer:latest",
        "id": "dave/cgrhpv/samtools-extract-bam-header-1-3/3",
        "sbg:project": "dave/cgrhpv",
        "sbg:cmdPreview": "samtools view  input_bam_or_sam_file.bam  -H -o input_bam_or_sam_file.txt",
        "sbg:toolkitVersion": "v1.3",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 1000
          },
          {
            "dockerPull": "cgrlab/typeseqer:latest",
            "class": "DockerRequirement"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "prefix": "-o",
            "position": 2,
            "valueFrom": {
              "script": "{\n filepath = $job.inputs.input_bam_or_sam_file.path\n\n filename = filepath.split(\"/\").pop();\n\n file_dot_sep = filename.split(\".\");\n file_ext = file_dot_sep[file_dot_sep.length-1];\n\n new_filename = filename.substr(0,filename.lastIndexOf(\".\"));\n \n extension = '.txt'\n             \n return new_filename + extension; \n}",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          },
          {
            "separate": true,
            "prefix": "",
            "position": 1,
            "valueFrom": {
              "script": "{\nreturn '-H'\n}",
              "class": "Expression",
              "engine": "#cwl-js-engine"
            }
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1520717721,
        "label": "SAMtools extract SAM/BAM header"
      },
      "outputs": [
        {
          "id": "#SAMtools_extract_SAM_BAM_header.output_header_file"
        }
      ],
      "sbg:y": 48.294185638427734
    },
    {
      "id": "#ion_typeseqer_report",
      "sbg:x": 1401.0019930301862,
      "inputs": [
        {
          "id": "#ion_typeseqer_report.startplugin_json",
          "source": "#run_manifest"
        },
        {
          "id": "#ion_typeseqer_report.scaling_table",
          "source": "#scaling_table"
        },
        {
          "id": "#ion_typeseqer_report.run_manifest",
          "source": "#plugin_manifest_parse.manifest_csv"
        },
        {
          "id": "#ion_typeseqer_report.report_grouping_csv",
          "source": "#plugin_report_grouping_parse.report_grouping"
        },
        {
          "id": "#ion_typeseqer_report.read_metrics_json",
          "source": "#merge_read_metrics.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.pos_neg_filtering_criteria_path",
          "source": "#pos_neg_filtering_criteria_path"
        },
        {
          "id": "#ion_typeseqer_report.parameter_file",
          "source": "#parameter_file"
        },
        {
          "id": "#ion_typeseqer_report.lineage_table_json",
          "source": "#merge_lineage.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.lineage_reference_table",
          "source": "#lineage_reference_table"
        },
        {
          "id": "#ion_typeseqer_report.is_torrent_server",
          "source": [
            "#is_torrent_server"
          ]
        },
        {
          "id": "#ion_typeseqer_report.hpv_types_json",
          "source": "#merge_HPV_types.merged_json"
        },
        {
          "id": "#ion_typeseqer_report.control_defs",
          "source": "#plugin_control_defs_parse.control_defs"
        },
        {
          "id": "#ion_typeseqer_report.bam_header_file",
          "source": "#SAMtools_extract_SAM_BAM_header.output_header_file"
        }
      ],
      "run": {
        "sbg:modifiedOn": 1532541774,
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:contributors": [
          "dave"
        ],
        "inputs": [
          {
            "id": "#startplugin_json",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#scaling_table",
            "sbg:fileTypes": "CSV",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#run_manifest",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#report_grouping_csv",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#read_metrics_json",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#pos_neg_filtering_criteria_path",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#parameter_file",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#lineage_table_json",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#lineage_reference_table",
            "type": [
              "null",
              "File"
            ],
            "required": false,
            "label": "lineage reference table"
          },
          {
            "id": "#is_torrent_server",
            "sbg:stageInput": null,
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "default": "",
            "id": "#hpv_types_json",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "id": "#control_defs",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#bam_header_file",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "baseCommand": [
          "Rscript",
          "-e",
          "'require(devtools);",
          "require(rmarkdown);",
          {
            "script": "\nif ($job.inputs.is_torrent_server) {\n    'system(paste0(\"cp \", system.file(\"extdata/ion_report\", \"Ion_Torrent_report.R\", package = \"TypeSeqHPV\"),\" ./\")); require(TypeSeqHPV); render(\"Ion_Torrent_report.R\"); system(paste0(\"cp Ion_Torrent_report.pdf \", final_pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\")); system(paste0(\"cp \", system.file(\"extdata/ion_report\", \"torrent_server_html_block.R\", package = \"TypeSeqHPV\"),\" ./\")); render(\"torrent_server_html_block.R\")'}\n\nelse {'run_type = \"not_ts\"; install_github(\"cgrlab/TypeSeqHPV\", force=TRUE); system(paste0(\"cp \", system.file(\"extdata/ion_report\", \"Ion_Torrent_report.R\", package = \"TypeSeqHPV\"),\" ./\")); require(TypeSeqHPV); render(\"Ion_Torrent_report.R\"); system(paste0(\"mv Ion_Torrent_report.pdf \", final_pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\"))'}",
            "class": "Expression",
            "engine": "#cwl-js-engine"
          },
          "'",
          "1>&2"
        ],
        "sbg:createdOn": 1526931198,
        "sbg:latestRevision": 27,
        "sbg:job": {
          "inputs": {
            "hpv_types_json": {
              "path": "path/to/merged_hpv_types.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "report_grouping_csv": {
              "path": "/path/to/report_grouping_csv.ext",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "lineage_table_json": {
              "path": "path/to/merged_lineage.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "bam_header_file": {
              "path": "/path/to/header_file.txt",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "startplugin_json": {
              "path": "/path/to/startplugin_json.ext",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "read_metrics_json": {
              "path": "/path/to/read_metrics.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "is_torrent_server": true,
            "scaling_table": {
              "path": "/path/to/scaling_table.csv",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "control_defs": {
              "path": "/path/to/control_defs.csv",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "pos_neg_filtering_criteria_path": {
              "path": "/path/to/2017-06-11_Pos-Neg_matrix_filtering_criteria_RefTable_v3.txt",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "run_manifest": {
              "path": "path/to/run_manifest.csv",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "min_lineage_read_count": 5,
            "parameter_file": {
              "path": "/path/to/parameter_file.csv",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "create_lineage_table_output": true
          },
          "allocatedResources": {
            "mem": 2000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 1401.0019930301862,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": "Copy of dave/rd111-typing-v2/ion-typeseqer-report/5",
            "sbg:revision": 0,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1526931198
          },
          {
            "sbg:revisionNotes": "fixing num_types_positive in grouped samples only matrix",
            "sbg:revision": 1,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1526931368
          },
          {
            "sbg:revisionNotes": "added conditional display",
            "sbg:revision": 2,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1527090879
          },
          {
            "sbg:revisionNotes": "fixing num types pos for grouped output",
            "sbg:revision": 3,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1527192146
          },
          {
            "sbg:revisionNotes": "added lineage table to report",
            "sbg:revision": 4,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1527870418
          },
          {
            "sbg:revisionNotes": "added lineage table output glob",
            "sbg:revision": 5,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1527870640
          },
          {
            "sbg:revisionNotes": "added lineage refernce table input",
            "sbg:revision": 6,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1527871115
          },
          {
            "sbg:revisionNotes": "added safe lineage plot funciton",
            "sbg:revision": 7,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1528136584
          },
          {
            "sbg:revisionNotes": "removed last line of rscript syntax error",
            "sbg:revision": 8,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1528139518
          },
          {
            "sbg:revisionNotes": "added is_tn",
            "sbg:revision": 9,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1528168462
          },
          {
            "sbg:revisionNotes": "removed min lineage read count and create lineage output params b/c ot suing them also added much code docs",
            "sbg:revision": 10,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1528910819
          },
          {
            "sbg:revisionNotes": "rm lineage read count from args.R",
            "sbg:revision": 11,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1529006928
          },
          {
            "sbg:revisionNotes": "corrected args.R",
            "sbg:revision": 12,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1529009455
          },
          {
            "sbg:revisionNotes": "better lineage matrix and plots",
            "sbg:revision": 13,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1529264555
          },
          {
            "sbg:revisionNotes": "switched to TypeSeqer package",
            "sbg:revision": 14,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530021192
          },
          {
            "sbg:revisionNotes": "corrected final_pn_matrix cp end cmd",
            "sbg:revision": 15,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530026494
          },
          {
            "sbg:revisionNotes": "switched to typeseqerd2 docker",
            "sbg:revision": 16,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530036925
          },
          {
            "sbg:revisionNotes": "put cp pdf back in for ts",
            "sbg:revision": 17,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530036999
          },
          {
            "sbg:revisionNotes": "removed links from ts tn html block",
            "sbg:revision": 18,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530046314
          },
          {
            "sbg:revisionNotes": "",
            "sbg:revision": 19,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1530099867
          },
          {
            "sbg:revisionNotes": "updated R package name",
            "sbg:revision": 20,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1531490619
          },
          {
            "sbg:revisionNotes": "fixing R package name",
            "sbg:revision": 21,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1531494329
          },
          {
            "sbg:revisionNotes": "final_2018071301",
            "sbg:revision": 22,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1531515784
          },
          {
            "sbg:revisionNotes": "moved html block to TypeSeq pakcage",
            "sbg:revision": 23,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1532375120
          },
          {
            "sbg:revisionNotes": "",
            "sbg:revision": 24,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1532375182
          },
          {
            "sbg:revisionNotes": "2018072301 docker tag",
            "sbg:revision": 25,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1532394335
          },
          {
            "sbg:revisionNotes": "added a require TypeSeqHPV",
            "sbg:revision": 26,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1532532070
          },
          {
            "sbg:revisionNotes": "added another require TypeSeqHPV",
            "sbg:revision": 27,
            "sbg:modifiedBy": "dave",
            "sbg:modifiedOn": 1532541774
          }
        ],
        "sbg:projectName": "CGR_Apps",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:validationErrors": [],
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "\"*samples_only_matrix.csv\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#samples_only_matrix",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*read_metrics.csv'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#read_metrics_csv",
            "default": "",
            "streamable": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "\"*pn_matrix.csv\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#pos_neg_matrix",
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "\"*plot_data.csv\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#plot_data",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*pdf'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#pdf_report",
            "type": [
              "null",
              {
                "items": "File",
                "type": "array"
              }
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "\"*lineage_matrix.csv\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#hpv_types_json"
            },
            "id": "#lineage_table",
            "type": [
              "null",
              "File"
            ],
            "label": "lineage table"
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*hpv_read_counts_matrix.csv'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#run_manifest"
            },
            "id": "#hpv_read_counts_matrix",
            "default": "",
            "streamable": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "\"*failed_samples_matrix.csv\"",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#hpv_types_json"
            },
            "id": "#failed_samples_matrix",
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*control_results.csv'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              },
              "sbg:inheritMetadataFrom": "#hpv_types_json"
            },
            "id": "#control_matrix",
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:revision": 27,
        "class": "CommandLineTool",
        "y": 182.23207569229092,
        "sbg:id": "dave/cgr-apps/ion-typeseqer-report/27",
        "sbg:revisionNotes": "added another require TypeSeqHPV",
        "id": "dave/cgr-apps/ion-typeseqer-report/27",
        "sbg:cmdPreview": "Rscript -e 'require(rmarkdown); render(\"TypeSeqer_report_pdf.R\"); system(paste0(\"cp TypeSeqer_report_pdf.pdf \", pn_matrix$Assay_Batch_Code[1], \"_qc_report.pdf\")); render(\"hpv_typing_html.R\") ' 1>&2",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 2000
          },
          {
            "dockerPull": "cgrlab/typeseqhpv:final_2018072301",
            "class": "DockerRequirement"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          },
          {
            "class": "CreateFileRequirement",
            "fileDef": [
              {
                "filename": "args.R",
                "fileContent": {
                  "script": "'# get args \\n\\\nargs_control_defs = \"'+$job.inputs.control_defs.path+'\" \\n\\\nargs_run_manifest_path =  \"'+$job.inputs.run_manifest.path+'\" \\n\\\nargs_bam_header_path =  \"'+$job.inputs.bam_header_file.path+'\" \\n\\\nargs_read_metrics_path = \"'+$job.inputs.read_metrics_json.path+'\" \\n\\\nargs_pos_neg_filtering_criteria_path = \"'+$job.inputs.pos_neg_filtering_criteria_path.path+'\" \\n\\\nargs_hpv_types_path = \"'+$job.inputs.hpv_types_json.path+'\" \\n\\\nargs_lineage_table_path = \"'+$job.inputs.lineage_table_json.path+'\" \\n\\\nargs_scaling_table = \"'+$job.inputs.scaling_table.path+'\" \\n\\\nargs_parameter_file_path = \"'+$job.inputs.parameter_file.path+'\" \\n\\\nargs_is_torrent_server = \"'+$job.inputs.is_torrent_server+'\" \\n\\\nargs_start_plugin_path = \"'+$job.inputs.startplugin_json.path+'\" \\n\\\nargs_lineage_reference_path = \"'+$job.inputs.lineage_reference_table.path+'\" \\n\\\nargs_custom_groups_path = \"'+$job.inputs.report_grouping_csv.path+'\"';",
                  "class": "Expression",
                  "engine": "#cwl-js-engine"
                }
              }
            ]
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:project": "dave/cgr-apps",
        "label": "hpv_typing_report"
      },
      "outputs": [
        {
          "id": "#ion_typeseqer_report.samples_only_matrix"
        },
        {
          "id": "#ion_typeseqer_report.read_metrics_csv"
        },
        {
          "id": "#ion_typeseqer_report.pos_neg_matrix"
        },
        {
          "id": "#ion_typeseqer_report.plot_data"
        },
        {
          "id": "#ion_typeseqer_report.pdf_report"
        },
        {
          "id": "#ion_typeseqer_report.lineage_table"
        },
        {
          "id": "#ion_typeseqer_report.hpv_read_counts_matrix"
        },
        {
          "id": "#ion_typeseqer_report.failed_samples_matrix"
        },
        {
          "id": "#ion_typeseqer_report.control_matrix"
        }
      ],
      "sbg:y": 182.23207569229092
    },
    {
      "id": "#ion_torrent_typing_read_processor_1",
      "sbg:x": 852.1156005859375,
      "inputs": [
        {
          "id": "#ion_torrent_typing_read_processor_1.parameter_file",
          "source": "#parameter_file"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.lineage_reference_table",
          "source": "#lineage_reference_table"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.create_lineage_table_output"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.barcode_list",
          "source": "#barcode_list"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.bam_json",
          "source": "#Sambamba_View.filtered"
        }
      ],
      "scatter": "#ion_torrent_typing_read_processor_1.bam_json",
      "run": {
        "$namespaces": {
          "sbg": "https://sevenbridges.com"
        },
        "sbg:revisionsInfo": [
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 0,
            "sbg:modifiedOn": 1526505561
          },
          {
            "sbg:revisionNotes": null,
            "sbg:modifiedBy": "dave",
            "sbg:revision": 1,
            "sbg:modifiedOn": 1526505586
          },
          {
            "sbg:revisionNotes": "added lineage code back in",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 2,
            "sbg:modifiedOn": 1527619937
          },
          {
            "sbg:revisionNotes": "corrected lineage path args.R",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 3,
            "sbg:modifiedOn": 1527625377
          },
          {
            "sbg:revisionNotes": "removed and args.R typo",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 4,
            "sbg:modifiedOn": 1527693022
          },
          {
            "sbg:revisionNotes": "correteing args.R issue",
            "sbg:modifiedBy": "dave",
            "sbg:revision": 5,
            "sbg:modifiedOn": 1527697061
          }
        ],
        "inputs": [
          {
            "default": "",
            "id": "#parameter_file",
            "streamable": false,
            "required": false,
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "secondaryFiles": []
            },
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#lineage_reference_table",
            "streamable": false,
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#create_lineage_table_output",
            "streamable": false,
            "required": false,
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true
            },
            "type": [
              "null",
              "boolean"
            ]
          },
          {
            "id": "#barcode_list",
            "required": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "default": "",
            "id": "#bam_json",
            "streamable": false,
            "required": false,
            "inputBinding": {
              "separate": true,
              "position": 0,
              "sbg:cmdInclude": true,
              "secondaryFiles": []
            },
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "baseCommand": [
          "Rscript",
          "-e",
          "'is_batch=\"true\";",
          "source(\"ion_torrent_typing_read_processor.R\")'"
        ],
        "sbg:createdOn": 1526505561,
        "sbg:latestRevision": 5,
        "sbg:job": {
          "inputs": {
            "lineage_reference_table": {
              "path": "/path/to/lineage_reference_table.ext",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "bam_json": {
              "path": "path/to/ IonXpress_075_Auto_user_S5XL-0039-25-2017-01-10_RD111_HPV-T_T163_SUCCEED_104_005.split.json",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "barcode_list": {
              "path": "/path/to/barcode_list.ext",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "parameter_file": {
              "path": "/path/to/parameter_file.ext",
              "class": "File",
              "size": 0,
              "secondaryFiles": []
            },
            "create_lineage_table_output": true
          },
          "allocatedResources": {
            "mem": 2000,
            "cpu": 1
          }
        },
        "sbg:sbgMaintained": false,
        "x": 852.1156005859375,
        "sbg:createdBy": "dave",
        "sbg:appVersion": [
          "sbg:draft-2"
        ],
        "sbg:contributors": [
          "dave"
        ],
        "sbg:projectName": "CGR_Apps",
        "sbg:image_url": null,
        "cwlVersion": "sbg:draft-2",
        "sbg:revision": 5,
        "sbg:publisher": "sbg",
        "outputs": [
          {
            "outputBinding": {
              "glob": {
                "script": "'*read_metrics.json'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              }
            },
            "id": "#read_metrics",
            "default": "",
            "streamable": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*bc2_demultiplex.json'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              }
            },
            "id": "#hpv_types",
            "default": "",
            "streamable": false,
            "type": [
              "null",
              "File"
            ]
          },
          {
            "outputBinding": {
              "glob": {
                "script": "'*_hpv_lineage.json'",
                "class": "Expression",
                "engine": "#cwl-js-engine"
              }
            },
            "id": "#hpv_lineage",
            "default": "",
            "streamable": false,
            "type": [
              "null",
              "File"
            ]
          }
        ],
        "sbg:id": "dave/cgr-apps/ion-torrent-typing-read-processor/5",
        "class": "CommandLineTool",
        "y": 670.492431640625,
        "sbg:validationErrors": [],
        "sbg:revisionNotes": "correteing args.R issue",
        "id": "dave/cgr-apps/ion-torrent-typing-read-processor/5",
        "sbg:project": "dave/cgr-apps",
        "sbg:cmdPreview": "Rscript ion_torrent_typing_read_processor.R  1>&2",
        "hints": [
          {
            "class": "sbg:CPURequirement",
            "value": 1
          },
          {
            "class": "sbg:MemRequirement",
            "value": 2000
          },
          {
            "dockerPull": "cgrlab/typeseqer:0.5.02",
            "class": "DockerRequirement"
          }
        ],
        "arguments": [
          {
            "separate": true,
            "position": 100,
            "valueFrom": "1>&2"
          }
        ],
        "requirements": [
          {
            "class": "ExpressionEngineRequirement",
            "requirements": [
              {
                "dockerPull": "rabix/js-engine",
                "class": "DockerRequirement"
              }
            ],
            "id": "#cwl-js-engine"
          },
          {
            "class": "CreateFileRequirement",
            "fileDef": [
              {
                "filename": "args.R",
                "fileContent": {
                  "script": "\n'# get args \\n\\\nargs_create_lineage_table_output = \"'+$job.inputs.create_lineage_table_output+'\" \\n\\\nargs_bam_json = data_frame(path = \"'+$job.inputs.bam_json.path+'\", name = \"'+$job.inputs.bam_json.path.split(\"/\").reverse()[0].split(\".split.json\")[0]+'\") \\n\\\nargs_A_barcode = \"A'+$job.inputs.bam_json.path.split(\"IonXpress_\").reverse()[0].substr(1,2)+'\" \\n\\\nargs_lineage_reference_path = \"'+$job.inputs.lineage_reference_table.path+'\" \\n\\\nargs_barcode_list = \"'+$job.inputs.barcode_list.path+'\" \\n\\\nargs_parameter_file = data_frame(path = \"'+$job.inputs.parameter_file.path+'\")'",
                  "class": "Expression",
                  "engine": "#cwl-js-engine"
                }
              },
              {
                "filename": "ion_torrent_typing_read_processor.R",
                "fileContent": "# Databricks notebook source\n# load packages\n\nif (!exists(\"is_batch\")) {library(SparkR)}\n\ndynamic_require = function(x){\n  for( i in x ){\n    #  require returns TRUE invisibly if it was able to load package\n    if( ! require( i , character.only = TRUE ) ){\n      #  If package was not able to be loaded then re-install\n      install.packages( i , dependencies = TRUE )\n      #  Load package after installing\n      require( i , character.only = TRUE )\n    }\n  }\n}\n\ndynamic_require(c(\"tidyverse\",\n                  \"jsonlite\"))\n\ndynamic_require_bioc = function(x){\n  for( i in x ){\n    #  require returns TRUE invisibly if it was able to load package\n    if( ! require( i , character.only = TRUE ) ){\n      #  If package was not able to be loaded then re-install\n      source(\"https://bioconductor.org/biocLite.R\")\n      biocLite(i)\n      install.packages( i , dependencies = TRUE )\n      #  Load package after installing\n      require( i , character.only = TRUE )\n    }\n  }\n}\n\ndynamic_require_bioc(\"GenomicAlignments\")\n\nsessionInfo()\n\n\n# COMMAND ----------\n\nif (!exists(\"is_batch\")) {\n\nsystem(\"rm -r /databricks/driver/TypeSeqerHpvIon\") \nsystem(\"mkdir /databricks/driver/TypeSeqerHpvIon\")\nsetwd(\"/databricks/driver/TypeSeqerHpvIon\")  \n  \nargs_create_lineage_table_output = \"true\" \n\nargs_bam_json = data_frame(path = \"/databricks/driver/TypeSeqerHpvIon/IX68_200k.json\", name = \"IonXpress_068_rawlib.filtered.json\") \n\nargs_A_barcode = \"A68\" \n\nargs_lineage_reference_path=\"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/20180121_lineage_reference_table_and_filters_2.csv\"\n\nargs_barcode_list = \"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/barcodeList_v1.csv\" \n\nargs_parameter_file = data_frame(path = \"/dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/hpv_types_MQ_min_max_len_filters_JUNE2017_30-10bpLen_v6.txt\")\n  \nsystem(\"touch args.R\")\n  \n#create a smaller version of the raw reads bam json\n\nsystem(\"head -n 200000 /dbfs/FileStore/projects/RD111_TypeSeqer/lineage_test/IonXpress_068_rawlib.filtered.json > /databricks/driver/TypeSeqerHpvIon/IX68_200k.json\")\n\n}\n\n# COMMAND ----------\n\nread_lines(\"args.R\") %>% \nwriteLines()\nsource(\"args.R\")\n\n# COMMAND ----------\n\n# MAGIC %md\n# MAGIC \n# MAGIC ##Below are 2 functions used in this read processor app.\n# MAGIC \n# MAGIC * Read Metrics  \n# MAGIC * Barcode 2 demultiplex (includes lineage detectin inside this function)\n\n# COMMAND ----------\n\n# here are 3 funcions that are used in this run processor app\nts_read_metrics = function(bam_json_input, parameters_df_input){\n\n# only used in a jsonlite streaming function\n\nif(\"ZA\" %in% colnames(bam_json_input$tags)){ ZA_df = data_frame(ZA = bam_json_input$tags$ZA)}else{ZA_df = data_frame(ZA = rep(0, length(bam_json_input$qname)))}\n\nbam_json = bam_json_input %>%\nselect(qname, HPV_Type = rname, seq, mapq, cigar) %>%\nmutate(page_num = page) %>%\nbind_cols(ZA_df) %>%\nmutate(ZA = ifelse(is.na(ZA), 0, ZA)) %>%\nmutate(bc1_id = args_A_barcode) %>%\nmutate(file_name = args_bam_json$name) %>%\nmutate(total_reads = n()) %>%\n  \n# left join with parameters file that contians qualifying criteria for each hpv contig\nleft_join(parameters_df_input) %>%\n  \n# mapq greater than 0 - count multi-mapped / 0 mapping quaity and filter becuase cigar will be 0 so we cannot include past here\nmutate(mapq_greater_than_zero = ifelse(mapq != 0, 1, 0)) %>%\nmutate(mapq_greater_than_zero = sum(mapq_greater_than_zero)) %>%\nfilter(mapq > 0) %>%\n  \n# ZA\nmutate(pass_za = ifelse(str_length(seq) == ZA, 1, 0)) %>%\n  \n# aligned length within specific parameters\nmutate(cigar_seq = as.character(sequenceLayer(DNAStringSet(seq), cigar))) %>%\nmutate(cigar_len = str_length(cigar_seq)) %>%\nmutate(pass_seq_length = ifelse(\n  cigar_len >= min_len, ifelse(\n  cigar_len <= max_len, ifelse(\n  pass_za == 1, 1, 0), 0), 0)) %>%\n  \n# mapq is greater than specific parameters\nmutate(pass_mapq = ifelse(mapq >= min_mq, 1, 0)) %>%\n\nmutate(pass_mapq = ifelse(\n  mapq >= min_mq, ifelse(\n  pass_seq_length == 1, ifelse(\n  pass_za == 1, 1, 0), 0), 0)) %>%\n\n# sum up\nmutate(pass_za = sum(pass_za)) %>%\nmutate(pass_seq_length = sum(pass_seq_length)) %>%\nmutate(pass_mapq = sum(pass_mapq)) %>%\n# select the final colums and compress down to 1 row with distinct()\nselect(page_num, bc1_id, total_reads, mapq_greater_than_zero, pass_za, pass_seq_length, pass_mapq, file_name) %>%\ndistinct()\n  \n    \n}\n\n# COMMAND ----------\n\nts_demultiplex_bc2 = function(bam_json_input, parameters_df_input, barcode_list_input){\n\nif(\"ZA\" %in% colnames(bam_json_input$tags)){ ZA_df = data_frame(ZA = bam_json_input$tags$ZA)}else{ZA_df = data_frame(ZA = rep(0, length(bam_json_input$qname)))}\n\nbam_json = bam_json_input %>%\nselect(qname, HPV_Type = rname, seq, mapq, cigar) %>%\nmutate(page_num = page) %>%\nbind_cols(ZA_df) %>%\nmutate(ZA = ifelse(is.na(ZA), 0, ZA)) %>%\nmutate(bc1_id = args_A_barcode) %>%\nmutate(file_name = args_bam_json$name) %>%\nmutate(total_reads = n()) %>%\nmutate(seq_length = str_length(seq)) %>%\nleft_join(parameters_df) %>%\n\n# Filter 1 - mapq > 0 ----\nfilter(mapq > 0) %>%\n  \n# Filter 2 - ZA  ----\nfilter(str_length(seq) == ZA) %>%\n\n# Filter 3 - aligned length within specific parameters ----\nmutate(cigar_seq = as.character(sequenceLayer(DNAStringSet(seq), cigar))) %>%\nmutate(cigar_len = str_length(cigar_seq)) %>%\nfilter(cigar_len >= min_len & cigar_len <= max_len) %>%\n\n# Filter 4 - mapq is greater than specific parameters ----\nfilter(mapq >= min_mq)\n\n # filter 5 - barcode is perfect match ----\n\nbam_json_with_barcode = barcode_list %>%\nselect(bc2_id = id, bc_sequence = sequence, bc_adapter = adapter) %>%\nfilter(str_sub(bc2_id, end =1) == \"P\") %>%\nmutate(bc_length = str_length(bc_sequence)) %>%\ngroup_by(bc2_id, bc_sequence) %>%\ndo({\nbc_length = .$bc_length\nbc_sequence = .$bc_sequence\n\nbam_json_temp = bam_json %>%\nmutate(three_prime_seq = str_sub(seq, start = -(bc_length))) %>%\nfilter(three_prime_seq == bc_sequence)\n\n}) %>%\nungroup() %>%\nmutate(qualified_barcode_reads = n()) %>%\ngroup_by(file_name, bc1_id, bc2_id, HPV_Type) %>%\nmutate(HPV_Type_count = n()) %>%\nungroup()\n\n### lineage for 2017 ###\nlineage_output = bam_json_with_barcode %>%\nselect(bc1_id, bc2_id, qname, HPV_Type, mapq, cigar_seq, HPV_Type_count) %>%\ninner_join(lineage_reference_table, by = \"HPV_Type\") %>%\nmutate(lineage_tag = \"No value\") %>% \nmutate(lineage_tag = ifelse(str_sub(cigar_seq, Base_num, Base_num) == Base_ID,\n                            paste0(HPV_Type,\"_\", Lineage_ID), \"undetermined\")) %>%\ngroup_by(qname, HPV_Type, Lineage_ID) %>%\nmutate(lineage_tag = paste(lineage_tag, collapse = \",\")) %>%\nungroup() %>%\nselect(bc1_id, bc2_id,qname, HPV_Type, Lineage_ID, lineage_tag, cigar_seq, mapq, HPV_Type_count) %>%\ndistinct() %>%\nmutate(total_reads = n()) %>%\nmutate(lineage_tag = ifelse(str_detect(lineage_tag, \"undetermined\"), \"undetermined\", \"full match\")) %>%\ngroup_by(bc1_id, bc2_id, HPV_Type, Lineage_ID, lineage_tag) %>% \nmutate(lineage_read_count = n()) %>%\nungroup() %>%\nmutate(page_num = page) %>%\nselect(bc1_id, bc2_id, page_num, HPV_Type, Lineage_ID, lineage_tag, lineage_read_count, HPV_Type_count) %>%\ndistinct()\n####   \n  \n#### finish the bc2 demultiplex df ####\nhpv_types_output = bam_json_with_barcode %>%  \nselect(file_name, page_num, bc1_id, bc2_id, qualified_barcode_reads, HPV_Type, HPV_Type_count, display_order) %>%\ndistinct()\n  \n### make a list output ###\noutput = list(hpv_types_output = hpv_types_output, lineage_output = lineage_output)\n\n}\n\n# COMMAND ----------\n\nparameters_df = read_tsv(args_parameter_file$path) %>% \nmap_if(is.factor, as.character) %>% \nas_tibble() %>% \nmutate(min_mq = mq) %>% \nselect(-mq)\n\nlineage_reference_table = read_csv(args_lineage_reference_path) %>%\nmap_if(is.factor, as.character) %>% \nas_tibble() %>% \nglimpse()\n\nbarcode_list = read_csv(args_barcode_list)\npage = 1\n\n# COMMAND ----------\n\nread_metrics_output = file(paste0(args_bam_json$name,\"_read_metrics.json\"), open = \"wb\")\nbc2_demultiplex_output = file(paste0(args_bam_json$name,\"_bc2_demultiplex.json\"), open = \"wb\")\nlineage_output = file(paste0(args_bam_json$name,\"_hpv_lineage.json\"),open = \"wb\")\n\nstream_in(file(args_bam_json$path), handler = function(df){\n\nread_metrics_df = df %>% \nts_read_metrics(parameters_df)\n  \n\nbc2_demultiplex_df = df %>% \nts_demultiplex_bc2(parameters_df, barcode_list)\n\nstream_out(read_metrics_df, read_metrics_output, verbose = TRUE) \n  \nstream_out(bc2_demultiplex_df$hpv_types_output, bc2_demultiplex_output, verbose = TRUE) \n  \nstream_out(bc2_demultiplex_df$lineage_output, lineage_output, verbose = TRUE) \n  \npage <<- page + 1\n\n}, pagesize = 10000, verbose = FALSE)\n\nclose(read_metrics_output)\nclose(bc2_demultiplex_output)\nclose(lineage_output)"
              }
            ]
          }
        ],
        "sbg:modifiedBy": "dave",
        "sbg:modifiedOn": 1527697061,
        "label": "ion_torrent_typing_read_processor"
      },
      "outputs": [
        {
          "id": "#ion_torrent_typing_read_processor_1.read_metrics"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.hpv_types"
        },
        {
          "id": "#ion_torrent_typing_read_processor_1.hpv_lineage"
        }
      ],
      "sbg:y": 670.492431640625
    }
  ],
  "description": "",
  "sbg:latestRevision": 68,
  "sbg:createdOn": 1526931208,
  "sbg:categories": [
    "hpv_typing"
  ],
  "sbg:sbgMaintained": false,
  "sbg:canvas_x": -402,
  "sbg:createdBy": "dave",
  "sbg:appVersion": [
    "sbg:draft-2"
  ],
  "sbg:contributors": [
    "dave"
  ],
  "sbg:projectName": "CGR_Apps",
  "sbg:image_url": "https://cgc.sbgenomics.com/ns/brood/images/dave/cgr-apps/ion-hpv-typeseqer/68.png",
  "cwlVersion": "sbg:draft-2",
  "sbg:revision": 68,
  "sbg:canvas_zoom": 0.7999999999999998,
  "sbg:publisher": "sbg",
  "outputs": [
    {
      "id": "#read_metrics_csv",
      "sbg:x": 2000.58447265625,
      "required": false,
      "sbg:y": 654.3377075195312,
      "source": [
        "#ion_typeseqer_report.read_metrics_csv"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#read_metrics_csv"
    },
    {
      "id": "#hpv_read_counts_matrix",
      "sbg:x": 2031.8892831868293,
      "required": false,
      "sbg:y": 1003.5979641319502,
      "source": [
        "#ion_typeseqer_report.hpv_read_counts_matrix"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#hpv_read_counts_matrix"
    },
    {
      "id": "#pos_neg_matrix",
      "sbg:x": 2072.39208984375,
      "required": false,
      "sbg:y": 776.9196166992188,
      "source": [
        "#ion_typeseqer_report.pos_neg_matrix"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#pos_neg_matrix"
    },
    {
      "id": "#pdf_report",
      "sbg:x": 2117.765380859375,
      "required": false,
      "sbg:y": 249.97389221191406,
      "source": [
        "#ion_typeseqer_report.pdf_report"
      ],
      "type": [
        "null",
        {
          "items": "File",
          "type": "array"
        }
      ],
      "label": "#pdf_report"
    },
    {
      "id": "#samples_only_matrix",
      "sbg:x": 1896.36181640625,
      "required": false,
      "sbg:y": 21.809043884277344,
      "source": [
        "#ion_typeseqer_report.samples_only_matrix"
      ],
      "type": [
        "null",
        {
          "items": "File",
          "type": "array"
        }
      ],
      "label": "#samples_only_matrix"
    },
    {
      "id": "#failed_samples_matrix",
      "sbg:x": 2016.3116455078125,
      "required": false,
      "sbg:y": 330.0703125,
      "source": [
        "#ion_typeseqer_report.failed_samples_matrix"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#failed_samples_matrix"
    },
    {
      "id": "#control_matrix",
      "sbg:x": 1887.3902587890625,
      "required": false,
      "sbg:y": 409.1229553222656,
      "source": [
        "#ion_typeseqer_report.control_matrix"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#control_matrix"
    },
    {
      "id": "#plot_data",
      "sbg:x": 2094.200927734375,
      "type": [
        "null",
        {
          "items": "File",
          "type": "array"
        }
      ],
      "required": false,
      "sbg:y": 878.2462158203125,
      "source": [
        "#ion_typeseqer_report.plot_data"
      ],
      "sbg:includeInPorts": true,
      "label": "#plot_data"
    },
    {
      "id": "#lineage_table",
      "sbg:x": 2022.542724609375,
      "required": false,
      "sbg:y": 51.64321517944336,
      "source": [
        "#ion_typeseqer_report.lineage_table"
      ],
      "type": [
        "null",
        "File"
      ],
      "label": "#lineage_table"
    }
  ],
  "sbg:id": "dave/cgr-apps/ion-hpv-typeseqer/68",
  "sbg:toolkit": "hpv_typing",
  "sbg:canvas_y": 83,
  "sbg:toolAuthor": "cgrlab",
  "class": "Workflow",
  "sbg:validationErrors": [],
  "id": "https://cgc-api.sbgenomics.com/v2/apps/dave/cgr-apps/ion-hpv-typeseqer/68/raw/",
  "sbg:modifiedOn": 1532541890,
  "sbg:toolkitVersion": "",
  "hints": [
    {
      "class": "sbg:AWSInstanceType",
      "value": "c4.8xlarge;ebs-gp2;700"
    },
    {
      "class": "sbg:maxNumberOfParallelInstances",
      "value": "12"
    }
  ],
  "requirements": [
    {
      "class": "sbg:Metadata"
    }
  ],
  "sbg:modifiedBy": "dave",
  "sbg:project": "dave/cgr-apps",
  "label": "hpv typing ion workflow"
}
